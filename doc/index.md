# ä¸€ã€ç®€ä»‹

## æ­å»ºå‰å‡†å¤‡

- Vscode: å‰ç«¯äººå¿…å¤‡å†™ç ç¥å™¨
- Chromeï¼šå¯¹å¼€å‘è€…éå¸¸å‹å¥½çš„æµè§ˆå™¨(åæ­£æˆ‘æ˜¯å¾ˆä¾èµ–å®ƒçš„)
- Nodejs&npmï¼šé…ç½®æœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œå®‰è£… Node åä½ ä¼šå‘ç° npm ä¹Ÿä¼šä¸€èµ·å®‰è£…ä¸‹æ¥
- Vue.js devtoolsï¼šæµè§ˆå™¨è°ƒè¯•æ’ä»¶
- Vue Language Features (Volar)ï¼šVscode å¼€å‘ vue3 å¿…å¤‡æ’ä»¶ï¼Œæä¾›è¯­æ³•é«˜äº®æç¤ºï¼Œéå¸¸å¥½ç”¨
- Vue 3 Snippetsï¼švue3 å¿«æ·è¾“å…¥

## ä»‹ç» vite

- Viteï¼šä¸‹ä¸€ä»£å‰ç«¯å¼€å‘ä¸æ„å»ºå·¥å…·
  - æé€Ÿçš„å¼€å‘æœåŠ¡å™¨å¯åŠ¨
  - âš¡ï¸ è½»é‡å¿«é€Ÿçš„çƒ­æ¨¡å—é‡è½½ï¼ˆHMRï¼‰
  - ğŸ› ï¸ ä¸°å¯Œçš„åŠŸèƒ½
  - ğŸ“¦ è‡ªå¸¦ä¼˜åŒ–çš„æ„å»º
  - ğŸ”© é€šç”¨çš„æ’ä»¶æ¥å£
  - ğŸ”‘ å®Œå…¨ç±»å‹åŒ–çš„ API
- Vite ï¼ˆæ³•è¯­æ„ä¸º â€œè¿…é€Ÿâ€ï¼Œå‘éŸ³ /vit/ï¼‰æ˜¯ä¸€ç§å…¨æ–°çš„å‰ç«¯æ„å»ºå·¥å…·ï¼Œå®ƒæå¤§åœ°æ”¹å–„äº†å‰ç«¯å¼€å‘ä½“éªŒã€‚å®ƒä¸»è¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š
  - ä¸€ä¸ªå¼€å‘æœåŠ¡å™¨ï¼Œå®ƒåŸºäºåŸç”Ÿ ES æ¨¡å—æä¾›äº†ä¸°å¯Œçš„å†…å»ºåŠŸèƒ½ï¼Œå¦‚é€Ÿåº¦å¿«åˆ°æƒŠäººçš„æ¨¡å—çƒ­æ›´æ–°ï¼ˆHMRï¼‰ã€‚
  - ä¸€å¥—æ„å»ºæŒ‡ä»¤ï¼Œå®ƒä½¿ç”¨ Rollup æ‰“åŒ…ä½ çš„ä»£ç ï¼Œå¹¶ä¸”å®ƒæ˜¯é¢„é…ç½®çš„ï¼Œå¯ä»¥è¾“å‡ºç”¨äºç”Ÿäº§ç¯å¢ƒçš„ä¼˜åŒ–è¿‡çš„é™æ€èµ„æºã€‚
  - Vite æ„åœ¨æä¾›å¼€ç®±å³ç”¨çš„é…ç½®ï¼ŒåŒæ—¶å®ƒçš„ æ’ä»¶ API å’Œ JavaScript API å¸¦æ¥äº†é«˜åº¦çš„å¯æ‰©å±•æ€§ï¼Œå¹¶æœ‰å®Œæ•´çš„ç±»å‹æ”¯æŒã€‚

## ç›®æ ‡

- æ„å»ºé¡¹ç›®çš„è¦æ±‚å¦‚ä¸‹ï¼š
  - æ”¯æŒ Typescript
  - æ”¯æŒ vue3 è¯­æ³•
  - æ”¯æŒ ES6 è¯­æ³•
  - æ”¯æŒ Scss module
  - æ”¯æŒ Eslintã€Prettierã€Pre-commit hook
  - æ”¯æŒ HMR å¿«é€Ÿçƒ­æ›´æ–°
  - æ”¯æŒ element-ui æŒ‰éœ€å¼•å…¥ä¸ä¸»é¢˜æ ·å¼è¦†ç›–
  - æ”¯æŒ Proxy ä»£ç†ã€alias åˆ«å
  - å…¼å®¹ä¼ ç»Ÿæµè§ˆå™¨
  - å¼€å‘å¯åŠ¨é€Ÿåº¦è¦å¤Ÿå¿«ï¼Œä»¥ç§’è®¡ç®—
  - æ”¯æŒæ‡’åŠ è½½å’Œ chunk åˆ†å‰²

# äºŒã€åˆå§‹åŒ–é¡¹ç›®

- é‡‡ç”¨çš„ [vite 2.0](https://link.segmentfault.com/?enc=JadgkOebg1una78BjJbS4Q%3D%3D.uSLZJu4yWcX%2FnD7TbtnzF4RgEThDMa9AVu0W6OzJ3RUq9ZP7ygXSRf6ZT06f%2Fh98) æ¥åˆå§‹åŒ–æˆ‘ä»¬çš„é¡¹ç›®

```shell
# npm 6.x
npm create vite@latest vite-vue3-ts --template vue-ts

# npm 7+, extra double-dash is needed:
npm create vite@latest vite-vue3-ts -- --template vue-ts

# yarn
yarn create vite vite-vue3-ts --template vue-ts

# pnpm
pnpm create vite vite-vue3-ts -- --template vue-ts
```

# ä¸‰ã€çº¦æŸä»£ç é£æ ¼

## Eslint æ”¯æŒ

### å®‰è£…ä¾èµ–

- [pnpm](https://pnpm.io/zh/motivation)

```shell
# eslint å®‰è£…
pnpm i -D eslint
# eslint æ’ä»¶å®‰è£…
# Vue.js çš„å®˜æ–¹ ESLint æ’ä»¶ï¼Œæä¾›äº†ï¼Œä»¥åŠ .js æ–‡ä»¶ä¸­çš„ Vue ä»£ç çš„æ”¯æŒ
pnpm i -D eslint-plugin-vue
# é’ˆå¯¹ ts çš„ eslint plugin
pnpm i -D @typescript-eslint/eslint-plugin
# ä¸º prettier åœ¨ eslint ä¸­å·¥ä½œæä¾›æ”¯æŒ
pnpm i -D eslint-plugin-prettier
# typescript parser
# é’ˆå¯¹ eslint çš„ä¸€ä¸ª ts è§£æå™¨
pnpm i -D @typescript-eslint/parser
```

### é…ç½®

- æ–°å»º.eslintrc.jsï¼Œ.eslintignore ä¸¤ä¸ªæ–‡ä»¶ï¼Œæ›´ src åŒçº§ç›®å½•ï¼Œå†…å®¹å¦‚ä¸‹

```javascript
module.exports = {
  root: true,
  env: {
    browser: true,
    node: true,
    es2021: true,
  },
  parser: 'vue-eslint-parser',
  extends: [
    'eslint:recommended',
    'plugin:vue/vue3-recommended',
    'plugin:@typescript-eslint/recommended',
    // eslint-config-prettier çš„ç¼©å†™
    'prettier',
    'plugin:prettier/recommended',
  ],
  parserOptions: {
    ecmaVersion: 2020,
    parser: '@typescript-eslint/parser',
    sourceType: 'module',
    ecmaFeatures: {
      jsx: true,
    },
  },
  // eslint-plugin-vue @typescript-eslint/eslint-plugin eslint-plugin-prettierçš„ç¼©å†™
  plugins: ['vue', '@typescript-eslint', 'prettier'],
  rules: {
    '@typescript-eslint/ban-ts-ignore': 'off',
    '@typescript-eslint/no-unused-vars': 'off',
    '@typescript-eslint/explicit-function-return-type': 'off',
    '@typescript-eslint/no-explicit-any': 'off',
    '@typescript-eslint/no-var-requires': 'off',
    '@typescript-eslint/no-empty-function': 'off',
    '@typescript-eslint/no-use-before-define': 'off',
    '@typescript-eslint/ban-ts-comment': 'off',
    '@typescript-eslint/ban-types': 'off',
    '@typescript-eslint/no-non-null-assertion': 'off',
    '@typescript-eslint/explicit-module-boundary-types': 'off',
    'no-var': 'error',
    'prettier/prettier': 'error',
    // ç¦æ­¢å‡ºç°console
    'no-console': 'warn',
    // ç¦ç”¨debugger
    'no-debugger': 'warn',
    // ç¦æ­¢å‡ºç°é‡å¤çš„ case æ ‡ç­¾
    'no-duplicate-case': 'warn',
    // ç¦æ­¢å‡ºç°ç©ºè¯­å¥å—
    'no-empty': 'warn',
    // ç¦æ­¢ä¸å¿…è¦çš„æ‹¬å·
    'no-extra-parens': 'off',
    // ç¦æ­¢å¯¹ function å£°æ˜é‡æ–°èµ‹å€¼
    'no-func-assign': 'warn',
    // ç¦æ­¢åœ¨ returnã€throwã€continue å’Œ break è¯­å¥ä¹‹åå‡ºç°ä¸å¯è¾¾ä»£ç 
    'no-unreachable': 'warn',
    // å¼ºåˆ¶æ‰€æœ‰æ§åˆ¶è¯­å¥ä½¿ç”¨ä¸€è‡´çš„æ‹¬å·é£æ ¼
    curly: 'warn',
    // è¦æ±‚ switch è¯­å¥ä¸­æœ‰ default åˆ†æ”¯
    'default-case': 'warn',
    // å¼ºåˆ¶å°½å¯èƒ½åœ°ä½¿ç”¨ç‚¹å·
    'dot-notation': 'warn',
    // è¦æ±‚ä½¿ç”¨ === å’Œ !==
    eqeqeq: 'warn',
    // ç¦æ­¢ if è¯­å¥ä¸­ return è¯­å¥ä¹‹åæœ‰ else å—
    'no-else-return': 'warn',
    // ç¦æ­¢å‡ºç°ç©ºå‡½æ•°
    'no-empty-function': 'warn',
    // ç¦ç”¨ä¸å¿…è¦çš„åµŒå¥—å—
    'no-lone-blocks': 'warn',
    // ç¦æ­¢ä½¿ç”¨å¤šä¸ªç©ºæ ¼
    'no-multi-spaces': 'warn',
    // ç¦æ­¢å¤šæ¬¡å£°æ˜åŒä¸€å˜é‡
    'no-redeclare': 'warn',
    // ç¦æ­¢åœ¨ return è¯­å¥ä¸­ä½¿ç”¨èµ‹å€¼è¯­å¥
    'no-return-assign': 'warn',
    // ç¦ç”¨ä¸å¿…è¦çš„ return await
    'no-return-await': 'warn',
    // ç¦æ­¢è‡ªæˆ‘èµ‹å€¼
    'no-self-assign': 'warn',
    // ç¦æ­¢è‡ªèº«æ¯”è¾ƒ
    'no-self-compare': 'warn',
    // ç¦æ­¢ä¸å¿…è¦çš„ catch å­å¥
    'no-useless-catch': 'warn',
    // ç¦æ­¢å¤šä½™çš„ return è¯­å¥
    'no-useless-return': 'warn',
    // ç¦æ­¢å˜é‡å£°æ˜ä¸å¤–å±‚ä½œç”¨åŸŸçš„å˜é‡åŒå
    'no-shadow': 'off',
    // å…è®¸deleteå˜é‡
    'no-delete-var': 'off',
    // å¼ºåˆ¶æ•°ç»„æ–¹æ‹¬å·ä¸­ä½¿ç”¨ä¸€è‡´çš„ç©ºæ ¼
    'array-bracket-spacing': 'warn',
    // å¼ºåˆ¶åœ¨ä»£ç å—ä¸­ä½¿ç”¨ä¸€è‡´çš„å¤§æ‹¬å·é£æ ¼
    'brace-style': 'warn',
    // å¼ºåˆ¶ä½¿ç”¨éª†é©¼æ‹¼å†™æ³•å‘½åçº¦å®š
    camelcase: 'warn',
    // å¼ºåˆ¶ä½¿ç”¨ä¸€è‡´çš„ç¼©è¿›
    indent: 'off',
    // å¼ºåˆ¶åœ¨ JSX å±æ€§ä¸­ä¸€è‡´åœ°ä½¿ç”¨åŒå¼•å·æˆ–å•å¼•å·
    // 'jsx-quotes': 'warn',
    // å¼ºåˆ¶å¯åµŒå¥—çš„å—çš„æœ€å¤§æ·±åº¦4
    'max-depth': 'warn',
    // å¼ºåˆ¶æœ€å¤§è¡Œæ•° 300
    // "max-lines": ["warn", { "max": 1200 }],
    // å¼ºåˆ¶å‡½æ•°æœ€å¤§ä»£ç è¡Œæ•° 50
    // 'max-lines-per-function': ['warn', { max: 70 }],
    // å¼ºåˆ¶å‡½æ•°å—æœ€å¤šå…è®¸çš„çš„è¯­å¥æ•°é‡20
    'max-statements': ['warn', 100],
    // å¼ºåˆ¶å›è°ƒå‡½æ•°æœ€å¤§åµŒå¥—æ·±åº¦
    'max-nested-callbacks': ['warn', 3],
    // å¼ºåˆ¶å‡½æ•°å®šä¹‰ä¸­æœ€å¤šå…è®¸çš„å‚æ•°æ•°é‡
    'max-params': ['warn', 3],
    // å¼ºåˆ¶æ¯ä¸€è¡Œä¸­æ‰€å…è®¸çš„æœ€å¤§è¯­å¥æ•°é‡
    'max-statements-per-line': ['warn', { max: 1 }],
    // è¦æ±‚æ–¹æ³•é“¾ä¸­æ¯ä¸ªè°ƒç”¨éƒ½æœ‰ä¸€ä¸ªæ¢è¡Œç¬¦
    'newline-per-chained-call': ['warn', { ignoreChainWithDepth: 3 }],
    // ç¦æ­¢ if ä½œä¸ºå”¯ä¸€çš„è¯­å¥å‡ºç°åœ¨ else è¯­å¥ä¸­
    'no-lonely-if': 'warn',
    // ç¦æ­¢ç©ºæ ¼å’Œ tab çš„æ··åˆç¼©è¿›
    'no-mixed-spaces-and-tabs': 'warn',
    // ç¦æ­¢å‡ºç°å¤šè¡Œç©ºè¡Œ
    'no-multiple-empty-lines': 'warn',
    // ç¦æ­¢å‡ºç°;
    semi: ['warn', 'always'],
    // å¼ºåˆ¶åœ¨å—ä¹‹å‰ä½¿ç”¨ä¸€è‡´çš„ç©ºæ ¼
    'space-before-blocks': 'warn',
    // å¼ºåˆ¶åœ¨ functionçš„å·¦æ‹¬å·ä¹‹å‰ä½¿ç”¨ä¸€è‡´çš„ç©ºæ ¼
    // 'space-before-function-paren': ['warn', 'never'],
    // å¼ºåˆ¶åœ¨åœ†æ‹¬å·å†…ä½¿ç”¨ä¸€è‡´çš„ç©ºæ ¼
    'space-in-parens': 'warn',
    // è¦æ±‚æ“ä½œç¬¦å‘¨å›´æœ‰ç©ºæ ¼
    'space-infix-ops': 'warn',
    // å¼ºåˆ¶åœ¨ä¸€å…ƒæ“ä½œç¬¦å‰åä½¿ç”¨ä¸€è‡´çš„ç©ºæ ¼
    'space-unary-ops': 'warn',
    // å¼ºåˆ¶åœ¨æ³¨é‡Šä¸­ // æˆ– /* ä½¿ç”¨ä¸€è‡´çš„ç©ºæ ¼
    // "spaced-comment": "warn",
    // å¼ºåˆ¶åœ¨ switch çš„å†’å·å·¦å³æœ‰ç©ºæ ¼
    'switch-colon-spacing': 'warn',
    // å¼ºåˆ¶ç®­å¤´å‡½æ•°çš„ç®­å¤´å‰åä½¿ç”¨ä¸€è‡´çš„ç©ºæ ¼
    'arrow-spacing': 'warn',
    'prefer-const': 'warn',
    'prefer-rest-params': 'warn',
    'no-useless-escape': 'warn',
    'no-irregular-whitespace': 'warn',
    'no-prototype-builtins': 'warn',
    'no-fallthrough': 'warn',
    'no-extra-boolean-cast': 'warn',
    'no-case-declarations': 'warn',
    'no-async-promise-executor': 'warn',
  },
  globals: {
    defineProps: 'readonly',
    defineEmits: 'readonly',
    defineExpose: 'readonly',
    withDefaults: 'readonly',
  },
};
```

```javascript
# eslint å¿½ç•¥æ£€æŸ¥ (æ ¹æ®é¡¹ç›®éœ€è¦è‡ªè¡Œæ·»åŠ )
node_modules
dist
coverage
```

## prettier æ”¯æŒ

### å®‰è£…ä¾èµ–

```
# å®‰è£… prettier
pnpm i -D prettier
```

### è§£å†³ eslint å’Œ prettier å†²çª

æ–¹æ¡ˆ

- è§£å†³ ESLint ä¸­çš„æ ·å¼è§„èŒƒå’Œ prettier ä¸­æ ·å¼è§„èŒƒçš„å†²çªï¼Œä»¥ prettier çš„æ ·å¼è§„èŒƒä¸ºå‡†ï¼Œä½¿ ESLint ä¸­çš„æ ·å¼è§„èŒƒè‡ªåŠ¨å¤±æ•ˆ

å®‰è£…ä¾èµ–

```
# å®‰è£…æ’ä»¶ eslint-config-prettier
# ä¸º eslint ä»£ç æ ¡éªŒè§„åˆ™ä¸ prettier ä»£ç æ ¡éªŒè§„åˆ™éƒ¨åˆ†å†²çªæä¾›æ”¯æŒ
pnpm i -D eslint-config-prettier
```

### é…ç½®

- æ–°å»º.prettierrc.jsï¼Œ.prettierignore ä¸¤ä¸ªæ–‡ä»¶ï¼Œæ›´ src åŒçº§ç›®å½•ï¼Œå†…å®¹å¦‚ä¸‹

```javascript
module.exports = {
  tabWidth: 2,
  jsxSingleQuote: true,
  printWidth: 100,
  singleQuote: true,
  semi: true,
  overrides: [
    {
      files: '*.json',
      options: {
        printWidth: 200,
      },
    },
  ],
  arrowParens: 'always',
};
```

```javascript
# å¿½ç•¥æ ¼å¼åŒ–æ–‡ä»¶ (æ ¹æ®é¡¹ç›®éœ€è¦è‡ªè¡Œæ·»åŠ )
node_modules
dist
coverage
```

## è‡ªåŠ¨æ£€æµ‹

### å®‰è£…ä¾èµ–

```
pnpm install -D vite-plugin-checker
```

### é…ç½®

```typescript
import checker from 'vite-plugin-checker';
export default function configEslint() {
  return [
    checker({
      typescript: true,
      eslint: {
        lintCommand: 'eslint "./src/**/*.{vue,ts,tsx}"',
      },
    }),
  ];
}
```

```typescript
import configEslint from './eslint';
export default function createVitePlugins() {
  const vitePlugins = [configEslint()];
  return vitePlugins;
}
```

```typescript
import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';

import createVitePlugins from './config/plugins/index';

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [vue(), ...createVitePlugins()],
});
```

## stylelint

### å®‰è£…ä¾èµ–

```shell
pnpm i -D sass
pnpm i -D stylelint
pnpm i -D stylelint-config-standard
pnpm i -D stylelint-config-prettier
# pnpm i -D stylelint-config-html
pnpm i -D stylelint-order
pnpm i -D stylelint-scss
# pnpm i -D postcss
# pnpm i -D postcss-html
# pnpm i -D postcss-scss

```

### é…ç½®

```javascript
module.exports = {
  extends: ['stylelint-config-standard', 'stylelint-config-prettier'],
  plugins: ['stylelint-order', 'stylelint-scss'],
  // customSyntax: 'postcss-html',
  rules: {
    indentation: 2,
    'no-descending-specificity': null,
    'function-url-quotes': 'always',
    'string-quotes': 'double',
    'unit-case': null,
    'color-hex-case': 'lower',
    'color-hex-length': 'long',
    'block-opening-brace-space-before': 'always',
    'property-no-unknown': null,
    'no-empty-source': null,
    'selector-class-pattern': null,
    'selector-pseudo-class-no-unknown': [
      true,
      {
        ignorePseudoClasses: ['deep', 'global'],
      },
    ],
    'selector-pseudo-element-no-unknown': [
      true,
      {
        ignorePseudoElements: ['v-deep', 'v-global', 'v-slotted'],
      },
    ],
    'at-rule-no-unknown': [
      true,
      {
        ignoreAtRules: [
          'tailwind',
          'apply',
          'variants',
          'responsive',
          'screen',
          'function',
          'if',
          'each',
          'include',
          'mixin',
        ],
      },
    ],
    'named-grid-areas-no-invalid': null,
    'unicode-bom': 'never',
    'no-descending-specificity': null,
    'font-family-no-missing-generic-family-keyword': null,
    'declaration-colon-space-after': 'always-single-line',
    'declaration-colon-space-before': 'never',
    // 'declaration-block-trailing-semicolon': 'always',
    'rule-empty-line-before': [
      'always',
      {
        ignore: ['after-comment', 'first-nested'],
      },
    ],
    'unit-no-unknown': [true, { ignoreUnits: ['rpx'] }],
    'keyframes-name-pattern': null,
    'order/order': [
      [
        'dollar-variables',
        'custom-properties',
        'at-rules',
        'declarations',
        {
          type: 'at-rule',
          name: 'supports',
        },
        {
          type: 'at-rule',
          name: 'media',
        },
        'rules',
      ],
      { severity: 'warning' },
    ],
    'order/properties-order': [
      'position',
      'top',
      'right',
      'bottom',
      'left',
      'z-index',
      'display',
      'float',
      'width',
      'height',
      'max-width',
      'max-height',
      'min-width',
      'min-height',
      'padding',
      'padding-top',
      'padding-right',
      'padding-bottom',
      'padding-left',
      'margin',
      'margin-top',
      'margin-right',
      'margin-bottom',
      'margin-left',
      'margin-collapse',
      'margin-top-collapse',
      'margin-right-collapse',
      'margin-bottom-collapse',
      'margin-left-collapse',
      'overflow',
      'overflow-x',
      'overflow-y',
      'clip',
      'clear',
      'font',
      'font-family',
      'font-size',
      'font-smoothing',
      'osx-font-smoothing',
      'font-style',
      'font-weight',
      'hyphens',
      'src',
      'line-height',
      'letter-spacing',
      'word-spacing',
      'color',
      'text-align',
      'text-decoration',
      'text-indent',
      'text-overflow',
      'text-rendering',
      'text-size-adjust',
      'text-shadow',
      'text-transform',
      'word-break',
      'word-wrap',
      'white-space',
      'vertical-align',
      'list-style',
      'list-style-type',
      'list-style-position',
      'list-style-image',
      'pointer-events',
      'cursor',
      'background',
      'background-attachment',
      'background-color',
      'background-image',
      'background-position',
      'background-repeat',
      'background-size',
      'border',
      'border-collapse',
      'border-top',
      'border-right',
      'border-bottom',
      'border-left',
      'border-color',
      'border-image',
      'border-top-color',
      'border-right-color',
      'border-bottom-color',
      'border-left-color',
      'border-spacing',
      'border-style',
      'border-top-style',
      'border-right-style',
      'border-bottom-style',
      'border-left-style',
      'border-width',
      'border-top-width',
      'border-right-width',
      'border-bottom-width',
      'border-left-width',
      'border-radius',
      'border-top-right-radius',
      'border-bottom-right-radius',
      'border-bottom-left-radius',
      'border-top-left-radius',
      'border-radius-topright',
      'border-radius-bottomright',
      'border-radius-bottomleft',
      'border-radius-topleft',
      'content',
      'quotes',
      'outline',
      'outline-offset',
      'opacity',
      'filter',
      'visibility',
      'size',
      'zoom',
      'transform',
      'box-align',
      'box-flex',
      'box-orient',
      'box-pack',
      'box-shadow',
      'box-sizing',
      'table-layout',
      'animation',
      'animation-delay',
      'animation-duration',
      'animation-iteration-count',
      'animation-name',
      'animation-play-state',
      'animation-timing-function',
      'animation-fill-mode',
      'transition',
      'transition-delay',
      'transition-duration',
      'transition-property',
      'transition-timing-function',
      'background-clip',
      'backface-visibility',
      'resize',
      'appearance',
      'user-select',
      'interpolation-mode',
      'direction',
      'marks',
      'page',
      'set-link-source',
      'unicode-bidi',
      'speak',
    ],
  },
  ignoreFiles: ['**/*.js', '**/*.jsx', '**/*.tsx', '**/*.ts'],
};
```

```javascript
/dist/*
/public/*
public/*
```

## è„šæœ¬é…ç½®

```json
{
  "script": {
    "lint": "eslint src --fix --ext .ts,.tsx,.vue,.js,.jsx",
    "prettier": "prettier --write .",
    "stylelint": "stylelint --fix \"**/*.{vue,less,postcss,css,scss}\" --cache --cache-location node_modules/.cache/stylelint/"
  }
}
```

- ä¸Šé¢é…ç½®å®Œæˆå,å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤æµ‹è¯•ä¸‹ä»£ç æ£€æŸ¥ä¸ªæ ¼å¼åŒ–æ•ˆæœ:

```
# eslint æ£€æŸ¥
pnpm lint
# prettier è‡ªåŠ¨æ ¼å¼åŒ–
pnpm prettier
```

## é…ç½® husky + lint-staged

### æ¦‚è¿°

- ä½¿ç”¨ husky + lint-staged åŠ©åŠ›å›¢é˜Ÿç¼–ç è§„èŒƒ, husky&lint-staged å®‰è£…æ¨èä½¿ç”¨ mrm, å®ƒå°†æ ¹æ® package.json ä¾èµ–é¡¹ä¸­çš„ä»£ç è´¨é‡å·¥å…·æ¥å®‰è£…å’Œé…ç½® husky å’Œ lint-stagedï¼Œå› æ­¤è¯·ç¡®ä¿åœ¨æ­¤ä¹‹å‰å®‰è£…å¹¶é…ç½®æ‰€æœ‰ä»£ç è´¨é‡å·¥å…·ï¼Œå¦‚ Prettier å’Œ ESlint
- husky æ˜¯ä¸€ä¸ªä¸º git å®¢æˆ·ç«¯å¢åŠ  hook çš„å·¥å…·ã€‚å®‰è£…åï¼Œå®ƒä¼šè‡ªåŠ¨åœ¨ä»“åº“ä¸­çš„ .git/ ç›®å½•ä¸‹å¢åŠ ç›¸åº”çš„é’©å­ï¼›æ¯”å¦‚ pre-commit é’©å­å°±ä¼šåœ¨ä½ æ‰§è¡Œ git commit çš„è§¦å‘ã€‚
- é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨ pre-commit ä¸­å®ç°ä¸€äº›æ¯”å¦‚ lint æ£€æŸ¥ã€å•å…ƒæµ‹è¯•ã€ä»£ç ç¾åŒ–ç­‰æ“ä½œã€‚å½“ç„¶ï¼Œpre-commit é˜¶æ®µæ‰§è¡Œçš„å‘½ä»¤å½“ç„¶è¦ä¿è¯å…¶é€Ÿåº¦ä¸è¦å¤ªæ…¢ï¼Œæ¯æ¬¡ commit éƒ½ç­‰å¾ˆä¹…ä¹Ÿä¸æ˜¯ä»€ä¹ˆå¥½çš„ä½“éªŒã€‚
- lint-stagedï¼Œä¸€ä¸ªä»…ä»…è¿‡æ»¤å‡º Git ä»£ç æš‚å­˜åŒºæ–‡ä»¶(è¢« git add çš„æ–‡ä»¶)çš„å·¥å…·ï¼›è¿™ä¸ªå¾ˆå®ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬å¦‚æœå¯¹æ•´ä¸ªé¡¹ç›®çš„ä»£ç åšä¸€ä¸ªæ£€æŸ¥ï¼Œå¯èƒ½è€—æ—¶å¾ˆé•¿ï¼Œå¦‚æœæ˜¯è€é¡¹ç›®ï¼Œè¦å¯¹ä¹‹å‰çš„ä»£ç åšä¸€ä¸ªä»£ç è§„èŒƒæ£€æŸ¥å¹¶ä¿®æ”¹çš„è¯ï¼Œè¿™å¯èƒ½å°±éº»çƒ¦äº†å‘€ï¼Œå¯èƒ½å¯¼è‡´é¡¹ç›®æ”¹åŠ¨å¾ˆå¤§ã€‚
- æ‰€ä»¥è¿™ä¸ª lint-stagedï¼Œå¯¹å›¢é˜Ÿé¡¹ç›®å’Œå¼€æºé¡¹ç›®æ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å·¥å…·ï¼Œå®ƒæ˜¯å¯¹ä¸ªäººè¦æäº¤çš„ä»£ç çš„ä¸€ä¸ªè§„èŒƒå’Œçº¦æŸ

### å®‰è£… mrm

```
pnpm i mrm -D --registry=https://registry.npm.taobao.org
```

### å®‰è£… lint-staged

- mrm å®‰è£… lint-staged ä¼šè‡ªåŠ¨æŠŠ husky ä¸€èµ·å®‰è£…ä¸‹æ¥

```
npx mrm lint-staged
```

- æ‰§è¡Œå®Œæ¯•ä¹‹åä¼šåœ¨é¡¹ç›®çš„æ ¹ç›®å½•å‡ºç°ä¸€ä¸ª.husky çš„ç›®å½•ï¼Œç›®å½•ä¸‹æœ‰ä¸€ä¸ª pre-commit æ–‡ä»¶ï¼Œï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npx lint-staged
```

- å®‰è£…æˆåŠŸåä¼šå‘ç° package.json ä¸­å¤šäº†ä¸€ä¸‹å‡ ä¸ªé…ç½®

```json
{
  "script": {
    "prepare": "husky install"
  },
  "devDependencies": {
    "husky": "^7.0.4",
    "lint-staged": "^12.3.7",
    "mrm": "^4.0.0",
  },
  ,
  "lint-staged": {
    "*.{ts,tsx,vue,js,jsx}": "eslint --cache --fix",
    "*.css": "stylelint --fix"
  }
}
```

### é…ç½®

- å› ä¸ºæˆ‘ä»¬è¦ç»“åˆ prettier ä»£ç æ ¼å¼åŒ–,æ‰€æœ‰ä¿®æ”¹ä¸€ä¸‹é…ç½®

```json
{
  "scripts": {
    "lint": "eslint src --fix --ext .ts,.tsx,.vue,.js,.jsx",
    "prettier": "prettier --write .",
    "stylelint": "stylelint --fix \"**/*.{vue,scss,css}\"",
    "prepare": "husky install"
  },
  "husky": {
    "hooks": {
      "pre-commit": "lint-staged"
    }
  },
  "lint-staged": {
    "*.{vue,scss}": "npm run stylelint",
    "*.{js,jsx,vue,ts,tsx}": "npm run lint",
    "*.{js,jsx,vue,tsx,ts,scss,md,json}": ["prettier --write"]
  }
}
```

## è¸©å‘

- Unknown word (CssSyntaxError) é”™è¯¯
  - è¿™ä¸ªé”™è¯¯æ˜¯å› ä¸ºå®‰è£…çš„ stylelintã€stylelint-config-standardã€stylelint-scssã€stylelint-order æ’ä»¶ç‰ˆæœ¬å¤ªæ–°çš„é—®é¢˜ï¼Œå¯¹äº vue3 æ¨¡æ¿â½‚ä»¶çš„â½€æŒä¸æ˜¯å¾ˆå¥½ï¼Œä¸èƒ½æ­£ç¡®è¯†åˆ« .vue â½‚ä»¶çš„ css ä»£ç ã€‚æ‰€ä»¥å°†ä»¥ä¸Šä¸‰ä¸ªæ’ä»¶çš„ç‰ˆæœ¬é™â¼€ä¸ªâ¼¤ç‰ˆæœ¬å°±å¥½äº†
  - æœ€åçš„ç‰ˆæœ¬å¦‚ä¸‹ï¼š "stylelint": "^13.13.1", "stylelint-config-standard": "^22.0.0", "stylelint-scss": "^3.21.0"ã€"stylelint-order": "^4.0.0"ï¼›
  - å¦â¼€ç§è§£å†³â½…æ¡ˆæ˜¯å®‰è£… postcss-html æ’ä»¶ï¼Œä½†æ˜¯ stylelint 14 ç‰ˆæœ¬çš„æ’ä»¶æœ‰å¾ˆå¤šé—®é¢˜ï¼ŒéªŒè¯è§„åˆ™ä¹Ÿå’Œä¹‹å‰ä¸å¤ªâ¼€æ ·ï¼Œå¹¶ä¸” .scss â½‚ä»¶è¿˜éªŒè¯ä¸äº†ã€‚

## æ‰©å±•

- [ä»é›¶æ„å»ºå‰ç«¯ ESLint å·¥ä½œæµ](https://segmentfault.com/a/1190000022881634)
- [å½»åº•ææ‡‚ ESLint å’Œ Prettier](https://juejin.cn/post/6909788084666105864)

# å››ã€vite é…ç½®

## åˆ«åé…ç½®

### å®‰è£…ä¾èµ–

```shell
pnpm i -D @types/node
```

### é…ç½®

- vite.config.ts ä¸­æ–°å¢ resolve é…ç½®èŠ‚ç‚¹ï¼Œç”¨æ¥ç¼–è¯‘è¯†åˆ«ç”¨çš„

```typescript
import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';
import path from 'path';

import createVitePlugins from './config/plugins/index';

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [vue(), ...createVitePlugins()],
  server: {
    host: true,
    port: 3002,
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src'),
    },
  },
});
```

- tsconfig.json ä¸­æ–°å¢ paths å’Œ baseUrl é…ç½®èŠ‚ç‚¹ï¼Œæ˜¯ç”¨æ¥ç»™ Typescript è¯†åˆ«ç”¨çš„

```json
{
  "compilerOptions": {
    "target": "esnext",
    "useDefineForClassFields": true,
    "module": "esnext",
    "moduleResolution": "node",
    "strict": true,
    "jsx": "preserve",
    "sourceMap": true,
    "resolveJsonModule": true,
    "esModuleInterop": true,
    "lib": ["esnext", "dom"],
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    }
  },
  "include": ["src/**/*.ts", "src/**/*.d.ts", "src/**/*.tsx", "src/**/*.vue"]
}
```

### ä½¿ç”¨

```typescript
import { createApp } from 'vue';
import App from '@/App.vue';
import '@/index.scss';

createApp(App).mount('#app');
```

## ç¯å¢ƒå˜é‡

### è®¾ç½®ç¯å¢ƒå˜é‡

- æ–°å¢.envï¼Œ.env.testï¼Œ.env.stagingï¼Œ.env.production å››ä¸ªæ–‡ä»¶ï¼Œæ›´ src åŒçº§ç›®å½•
- åˆ†åˆ«ä»£è¡¨å¼€å‘ï¼Œæµ‹è¯•ï¼Œé¢„å‘ï¼Œç”Ÿäº§å››ä¸ªç¯å¢ƒå˜é‡ï¼Œå¦‚æœæƒ³è¦æ‰©å±•å…¶å®ƒçš„å˜é‡ï¼Œä»¥æ­¤ç±»æ¨
- è‡ªå®šä¹‰ç¯å¢ƒå˜é‡ä¸€å®šè¦æ˜¯ VITE ä¸ºå‰ç¼€çš„å˜é‡æ‰ä¼šæš´éœ²ç»™ vite,å¦‚ï¼šVITE_APP_TITLE

```
VITE_APP_TITLE="DEVELOPMENT APP"
```

```
VITE_APP_TITLE="TEST APP"
VITE_API_HOST=http://www.youbaobao.xyz
```

```
VITE_APP_TITLE="STAGING APP"
VITE_API_HOST=http://www.youbaobao.xyz
```

```
VITE_APP_TITLE="PRODUCTION APP"
VITE_API_HOST=http://www.youbaobao.xyz
```

### è®¾ç½®è„šæœ¬

- ä¹‹æ‰€ä»¥è¦åœ¨ package.json ä¸­çš„å‘½ä»¤åŠ --modeï¼Œæ˜¯ä¸ºäº†è¦†ç›–å‘½ä»¤ä½¿ç”¨çš„é»˜è®¤æ¨¡å¼ production,development

```json
"scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "build:test": "vite build --mode test",
    "build:staging": "vite build --mode staging",
    "preview": "vite preview",
  },
```

### è®¾ç½® typescript

```typescript
/// <reference types="vite/client" />

interface ImportMetaEnv {
  VITE_APP_TITLE: 'development' | 'test' | 'staging' | 'production';
}

interface ImportMeta {
  readonly env: ImportMetaEnv;
}
```

### è·å–ç¯å¢ƒå˜é‡

- åœ¨ vite ä¸­è·å–ç¯å¢ƒå˜é‡é€šè¿‡ï¼šimport.meta.env æ¥è·å–çš„ï¼Œå¹¶ä¸æ˜¯ process.envï¼Œå¦‚æœè¦åœ¨ä»£ç ä¸­ï¼Œæ¯æ¬¡é€šè¿‡ import.meta.env æ¥è·å–ï¼Œå†™çš„å®åœ¨ç¹çï¼Œä¸å¦‚å°è£…ä¸€ä¸ª hooks
- åœ¨ src æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–°å»º utils æ–‡ä»¶å¤¹ï¼Œutils æ–‡ä»¶å¤¹ä¸­æ–°å»º env.ts,åœ¨ src/utils/env.ts ä¸­ç¼–å†™å¦‚ä¸‹ä»£ç 

```typescript
export const getEnv = () => {
  return import.meta.env;
};
```

```typescript
import { getEnv } from './env';

export { getEnv };
```

### è‡ªå®šä¹‰é’©å­

```typescript
import { onMounted } from 'vue';
import { getEnv } from '@/utils';

export default function useTitle(title?: string): void {
  onMounted(() => {
    const { VITE_APP_TITLE } = getEnv();
    document.title = title ?? VITE_APP_TITLE ?? 'Vite Project';
  });
}
```

```typescript
import useTitle from './useTitle';

export { useTitle };
```

### é¡µé¢ä½¿ç”¨

```vue
<script setup lang="ts">
import HelloWorld from '@/components/HelloWorld.vue';
import { useTitle } from '@/hooks';
import { onMounted, ref } from 'vue';

// è®¾ç½® document title
useTitle();

const msg = ref('Hello Vue 3 + TypeScript + Vite');

onMounted(() => {
  msg.value = 'Hello Vue 3 + TypeScript + Vite !!!';
});
</script>

<template>
  <img alt="Vue logo" src="./assets/logo.png" />
  <HelloWorld :msg="msg" />
</template>

<style lang="scss">
#app {
  height: 100%;
  margin-top: 50px;
  font-family: Avenir, Helvetica, Arial, sans-serif;
  color: #2c3e50;
  text-align: center;
}
</style>
```

## server é…ç½®

- æ–°å»º config/index.ts æ–‡ä»¶ï¼Œæ–°å¢å¦‚ä¸‹ä»£ç 

```typescript
// todo server é…ç½®
/**
 * @description å¼€å‘ç«¯å£
 */
export const VITE_APP_PORT = 3002;
/**
 * @description å…¬å…±åŸºç¡€è·¯å¾„
 */
export const VITE_APP_BASE = '/';
/**
 * @description æ˜¯å¦è‡ªåŠ¨åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€åº”ç”¨ç¨‹åº
 */
export const VITE_APP_OPEN = true;
```

- æ–°å»º config/server/index.ts æ–‡ä»¶ï¼Œæ–°å¢å¦‚ä¸‹ä»£ç 

```typescript
import { ServerOptions } from 'vite';
import { VITE_APP_PORT, VITE_APP_OPEN } from '../index';

const server: ServerOptions = {
  host: true,
  port: VITE_APP_PORT,
  open: VITE_APP_OPEN,
};
export default server;
```

- æ‰¾åˆ° vite.config.ts æ–‡ä»¶ï¼Œä¿®æ”¹ server å±æ€§å¦‚ä¸‹ä»£ç 

```typescript
import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';
import path from 'path';

import createVitePlugins from './config/plugins/index';
import server from './config/server';
import { VITE_APP_BASE } from './config';

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [vue(), ...createVitePlugins()],
  base: VITE_APP_BASE,
  server,
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src'),
    },
  },
});
```

## proxy é…ç½®

- æ‰¾åˆ° config/server/index.ts æ–‡ä»¶ï¼Œæ–°å¢ proxy å±æ€§ï¼Œä¿®æ”¹å¦‚ä¸‹ä»£ç 

```typescript
import { ServerOptions, loadEnv } from 'vite';
import { VITE_APP_PORT, VITE_APP_OPEN } from '../index';

const createServer = (mode: string): ServerOptions => ({
  host: true,
  port: VITE_APP_PORT,
  open: VITE_APP_OPEN,
  proxy: {
    '/api': {
      target: loadEnv(mode, process.cwd()).VITE_API_HOST,
      changeOrigin: true,
      rewrite: (path: any) => path.replace(/^\/api/, ''),
    },
  },
});

export default createServer;
```

- æ‰¾åˆ° vite.config.ts æ–‡ä»¶ï¼Œä¿®æ”¹ server å±æ€§å¦‚ä¸‹ä»£ç 

```typescript
import { defineConfig, ConfigEnv } from 'vite';
import vue from '@vitejs/plugin-vue';
import path from 'path';

import createVitePlugins from './config/plugins/index';
import createServer from './config/server';
import { VITE_APP_BASE } from './config';

// https://vitejs.dev/config/
export default defineConfig(({ mode }: ConfigEnv) => ({
  plugins: [vue(), ...createVitePlugins()],
  base: VITE_APP_BASE,
  server: createServer(mode),
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src'),
    },
  },
}));
```

## build é…ç½®

### åŸºæœ¬é…ç½®

- æ‰¾åˆ° config/index.ts æ–‡ä»¶ï¼Œæ–°å¢å¦‚ä¸‹ä»£ç 

```typescript
// todo build é…ç½®
/**
 * @description æ˜¯å¦åœ¨æ‰“åŒ…ç¯å¢ƒä¸‹ï¼Œå¼€å¯æ‰“åŒ…çš„åˆ†æå¯è§†åŒ–å›¾
 */
export const VITE_APP_VISUALIZER = true;
/**
 * @description æ˜¯å¦åœ¨æ‰“åŒ…ç¯å¢ƒä¸‹ï¼Œå»é™¤console.log
 */
export const VITE_APP_CONSOLE = true;
/**
 * @description æ‰“åŒ…ç¯å¢ƒä¸‹ï¼Œåˆ é™¤debugger
 */
export const VITE_APP_DEBUGGER = true;
/**
 * @description æ‰“åŒ…ç¯å¢ƒä¸‹æ˜¯å¦ç”Ÿæˆsource map æ–‡ä»¶
 */
export const VITE_APP_SOURCEMAP = false;
```

- åœ¨ config æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–°å»º build/index.ts æ–‡ä»¶ï¼Œä¸”ç¼–å†™å¦‚ä¸‹ä»£ç 

```typescript
import { BuildOptions } from 'vite';
import { VITE_APP_CONSOLE, VITE_APP_DEBUGGER, VITE_APP_SOURCEMAP } from '../index';

const createBuild = (): BuildOptions => {
  return {
    minify: 'terser',
    terserOptions: {
      compress: {
        keep_infinity: true,
        drop_console: VITE_APP_CONSOLE, // å»é™¤ console
        drop_debugger: VITE_APP_DEBUGGER, // å»é™¤ debugger
      },
    },
    outDir: 'dist', // æŒ‡å®šè¾“å‡ºè·¯å¾„ç›®å½•
    assetsDir: 'assets', // æŒ‡å®šæ‰“åŒ…ç”Ÿæˆé™æ€èµ„æºçš„å­˜æ”¾è·¯å¾„ç›®å½•
    sourcemap: VITE_APP_SOURCEMAP, // æ„å»ºåæ˜¯å¦ç”Ÿæˆ source mapæ–‡ä»¶
  };
};

export default createBuild;
```

- æ‰¾åˆ° vite.config.ts æ–‡ä»¶ï¼Œæ–°å¢å¦‚ä¸‹ä»£ç 

```typescript
import { defineConfig, ConfigEnv } from 'vite';
import vue from '@vitejs/plugin-vue';
import path from 'path';

import createVitePlugins from './config/plugins/index';
import createServer from './config/server';
import createBuild from './config/build';
import { VITE_APP_BASE } from './config';

// https://vitejs.dev/config/
export default defineConfig(({ mode }: ConfigEnv) => ({
  plugins: [vue(), ...createVitePlugins()],
  base: VITE_APP_BASE,
  server: createServer(mode),
  build: createBuild(),
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src'),
    },
  },
}));
```

### æ‰“åŒ…çš„åˆ†æå¯è§†åŒ–å›¾

- å®‰è£…ä¾èµ–

```shell
npm install rollup rollup-plugin-visualizer -D
```

- åœ¨ config/plugins æ–‡ä»¶å¤¹ä¸­ï¼Œæ–°å»º visualizer.ts æ–‡ä»¶

```typescript
import visualizer from 'rollup-plugin-visualizer';

export default function configVisualizer() {
  return visualizer({
    // å°†æ‰“åŒ…çš„ä¾èµ–åˆ†æå¯è§†åŒ–é¡µé¢ï¼Œå†™åˆ°node_modulesä¸­ï¼Œè¿™æ ·ä¸å ä½ç½®
    filename: './node_modules/.cache/visualizer/stats.html',
    open: true,
    gzipSize: true,
    brotliSize: true,
  });
}
```

- æ‰¾åˆ° config/plugins/index.ts æ–‡ä»¶ï¼Œæ–°å¢å¦‚ä¸‹ä»£ç 

```typescript
import configEslint from './eslint';
import configVisualizer from './visualizer';
import { VITE_APP_VISUALIZER } from '../index';

export default function createVitePlugins() {
  const vitePlugins: any[] = [configEslint()];
  VITE_APP_VISUALIZER && vitePlugins.push(configVisualizer());
  return vitePlugins;
}
```

### å‹ç¼© Html

- å®‰è£…ä¾èµ–

```shell
npm install vite-plugin-html -D
```

- åœ¨ config/plugins æ–‡ä»¶å¤¹ä¸­ï¼Œæ–°å»º html.ts æ–‡ä»¶

```typescript
import { createHtmlPlugin } from 'vite-plugin-html';

export default function configHtml() {
  return createHtmlPlugin({
    minify: true,
  });
}
```

- æ‰¾åˆ° config/plugins/index.ts æ–‡ä»¶ï¼Œæ–°å¢å¦‚ä¸‹ä»£ç 

```typescript
import configEslint from './eslint';
import configVisualizer from './visualizer';
import configHtml from './html';
import { VITE_APP_VISUALIZER } from '../index';

export default function createVitePlugins() {
  const vitePlugins: any[] = [configEslint(), configHtml()];
  VITE_APP_VISUALIZER && vitePlugins.push(configVisualizer());
  return vitePlugins;
}
```

### å‹ç¼©èµ„æº

- å®‰è£…ä¾èµ–

```shell
npm install vite-plugin-compression -D
```

- åœ¨ config/plugins æ–‡ä»¶å¤¹ä¸­ï¼Œæ–°å»º compression.ts æ–‡ä»¶

```typescript
import viteCompression from 'vite-plugin-compression';

export default function configCompression() {
  // gzipå‹ç¼© ç”Ÿäº§ç¯å¢ƒç”Ÿæˆ .gz æ–‡ä»¶
  return viteCompression({
    verbose: true,
    disable: false,
    threshold: 10240,
    algorithm: 'gzip',
    ext: '.gz',
  });
}
```

- æ‰¾åˆ° config/plugins/index.ts æ–‡ä»¶ï¼Œæ–°å¢å¦‚ä¸‹ä»£ç 

```typescript
import configEslint from './eslint';
import configVisualizer from './visualizer';
import configHtml from './html';
import configCompression from './compression';
import { VITE_APP_VISUALIZER } from '../index';

export default function createVitePlugins() {
  const vitePlugins: any[] = [configEslint(), configHtml(), configCompression()];
  VITE_APP_VISUALIZER && vitePlugins.push(configVisualizer());
  return vitePlugins;
}
```

## å…¼å®¹ä¼ ç»Ÿæµè§ˆå™¨

### å®‰è£…ä¾èµ–

```shell
npm i -D @vitejs/plugin-legacy
```

### æ’ä»¶é…ç½®

- åœ¨ config/plugins æ–‡ä»¶å¤¹ä¸­ï¼Œæ–°å»º legacy.ts æ–‡ä»¶

```typescript
import legacy from '@vitejs/plugin-legacy';

export default function configLegacy() {
  return legacy({
    // targets: ['ie >= 11', 'Android >= 39', 'Chrome >= 39', 'Safari >= 10.1', 'iOS >= 10', '> 0.5%'],
    // polyfills: ['es.promise', 'regenerator-runtime'],
    targets: ['ie >= 11'],
    additionalLegacyPolyfills: ['regenerator-runtime/runtime'],
  });
}
```

- æ‰¾åˆ° config/plugins/index.ts æ–‡ä»¶ï¼Œæ–°å¢å¦‚ä¸‹ä»£ç 

```typescript
import configEslint from './eslint';
import configVisualizer from './visualizer';
import configHtml from './html';
import configCompression from './compression';
import configLegacy from './legacy';
import { VITE_APP_VISUALIZER } from '../index';

export default function createVitePlugins() {
  const vitePlugins: any[] = [configEslint(), configHtml(), configCompression(), configLegacy()];
  VITE_APP_VISUALIZER && vitePlugins.push(configVisualizer());
  return vitePlugins;
}
```

# äº”ã€CSS é¢„å¤„ç†å™¨

- è™½ç„¶ vite åŸç”Ÿæ”¯æŒ less/sass/scss/stylusï¼Œä½†æ˜¯ä½ å¿…é¡»æ‰‹åŠ¨å®‰è£…ä»–ä»¬çš„é¢„å¤„ç†å™¨ä¾èµ–
- vite é»˜è®¤æ˜¯æ”¯æŒ module çš„ï¼Œåªéœ€å°†æ–‡ä»¶åç§°åŠ ä¸€ä¸ª module å³å¯ï¼Œå¦‚ï¼šxx.module.css,è¿™æ ·å°±å˜æˆäº† module äº†ï¼Œæ›´ create-react-app ä¸€æ ·çš„å†™æ³•ã€‚
- scss/less çš„ module æ¨¡å¼åŒ css ä¸€æ ·ï¼Œå¦‚ï¼šxx.module.scss,xx.module.less

## å®‰è£…ä¾èµ–

```shell
pnpm install -D sass
```

## å…¨å±€å˜é‡

- åœ¨ src æ–‡ä»¶å¤¹ä¸‹æ–°å¢ styles æ–‡ä»¶å¤¹ï¼Œåœ¨ styles æ–‡ä»¶å¤¹ä¸­æ–°å¢ variables.scssã€mixins.scssã€transition.scssã€common.scssã€index.scss æ–‡ä»¶ï¼Œç¼–å†™å¦‚ä¸‹ä»£ç ï¼š

```less
$bg: #282c34;
```

```less
@mixin flexContainer($dir: column, $jc: center, $align: center) {
  display: flex;
  flex-direction: $dir;
  align-items: $align;
  justify-content: $jc;
}
@mixin style($size, $color, $bold: normal) {
  font-size: $size;
  color: $color;
  font-weight: $bold;
}
```

```less
@import './variables.scss';
@import './mixins.scss';
@import './common.scss';
@import './transition.scss';
```

## é…ç½®

- åœ¨ config æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–°å¢ style æ–‡ä»¶å¤¹ï¼Œä¸”åœ¨ style æ–‡ä»¶å¤¹ä¸‹æ–°å¢ index.tsï¼Œconfig/style/index.ts ä¸­ç¼–å†™å¦‚ä¸‹ä»£ç ï¼š

```typescript
import { CSSOptions } from 'vite';

const createCss = (): CSSOptions => {
  return {
    preprocessorOptions: {
      less: {
        javascriptEnabled: true,
      },
      scss: {
        additionalData: '@import "./src/styles/index.scss";',
      },
    },
  };
};

export default createCss;
```

> **æ³¨æ„ç‚¹:**
> additionalData ä¸­å¦‚æœå¼•ç”¨@import æ ¼å¼çš„ï¼Œåé¢ä¸€å®šè¦åŠ ;å¦åˆ™ä¼šæŠ¥é”™

```typescript
import { defineConfig, ConfigEnv } from 'vite';
import vue from '@vitejs/plugin-vue';
import path from 'path';

import createVitePlugins from './config/plugins/index';
import createServer from './config/server';
import createBuild from './config/build';
import createCss from './config/style';
import { VITE_APP_BASE } from './config';

// https://vitejs.dev/config/
export default defineConfig(({ mode }: ConfigEnv) => ({
  plugins: [vue(), ...createVitePlugins()],
  base: VITE_APP_BASE,
  server: createServer(mode),
  build: createBuild(),
  css: createCss(),
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src'),
    },
  },
}));
```

## ä½¿ç”¨

- å°† src/App.vue ä¸­ï¼Œæ›´æ”¹æ–‡ä»¶ä¸­çš„ä»£ç ï¼š

```less
<script setup lang="ts">
import HelloWorld from '@/components/HelloWorld.vue';
import { useTitle } from '@/hooks';
import { onMounted, ref } from 'vue';

// è®¾ç½® document title
useTitle();

const msg = ref('Hello Vue 3 + TypeScript + Vite');

onMounted(() => {
  msg.value = 'Hello Vue 3 + TypeScript + Vite !!!';
  fetch('/api/datav-res/datav/map.json')
    .then((res) => res.json())
    .then((data) => console.log(data));
});
</script>

<template>
  <header>Vue3 + vite</header>
  <img alt="Vue logo" src="./assets/logo.png" />
  <HelloWorld :msg="msg" />
</template>

<style lang="scss">
#app {
  height: 100%;
  font-family: Avenir, Helvetica, Arial, sans-serif;
  color: #2c3e50;
  text-align: center;
  header {
    @include style(calc(10px + 2vmin), #ffffff);
    @include flexContainer();
    min-height: 60px;
    background-color: $bg;
  }
  img {
    height: 20vmin;
    pointer-events: none;
  }
  button {
    font-size: calc(10px + 1vmin);
  }
}
</style>
```

# å…­ã€è·¯ç”±

## å®‰è£…ä¾èµ–

- [router](https://router.vuejs.org/zh/introduction.html)

```shell
pnpm install -S vue-router
```

## è·¯ç”±é…ç½®

- vue-router4.x æ”¯æŒ typescriptï¼Œé…ç½®è·¯ç”±çš„ç±»å‹æ˜¯ RouteRecordRawï¼Œè¿™é‡Œ meta å¯ä»¥è®©æˆ‘ä»¬æœ‰æ›´å¤šçš„å‘æŒ¥ç©ºé—´ï¼Œè¿™é‡Œæä¾›ä¸€äº›å‚è€ƒï¼š
  - title:string; é¡µé¢æ ‡é¢˜ï¼Œé€šå¸¸å¿…é€‰ã€‚
  - icon?:string; å›¾æ ‡ï¼Œä¸€èˆ¬é…åˆèœå•ä½¿ç”¨ã€‚
  - auth?:boolean; æ˜¯å¦éœ€è¦ç™»å½•æƒé™ã€‚
  - ignoreAuth?:boolean; æ˜¯å¦å¿½ç•¥æƒé™ã€‚
  - roles?:RoleEnum[]; å¯ä»¥è®¿é—®çš„è§’è‰²
  - keepAlive?:boolean; æ˜¯å¦å¼€å¯é¡µé¢ç¼“å­˜
  - hideMenu?:boolean; æœ‰äº›è·¯ç”±æˆ‘ä»¬å¹¶ä¸æƒ³åœ¨èœå•ä¸­æ˜¾ç¤ºï¼Œæ¯”å¦‚æŸäº›ç¼–è¾‘é¡µé¢ã€‚
  - order?:number; èœå•æ’åºã€‚
  - frameUrl?:string; åµŒå¥—å¤–é“¾ã€‚
- åœ¨ src æ–‡ä»¶å¤¹ä¸‹æ–°å¢ routes æ–‡ä»¶å¤¹ => index.ts æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹:

```typescript
import { createRouter, createWebHashHistory } from 'vue-router';

export const routes = [
  {
    path: '/',
    redirect: '/home',
  },
  {
    path: '/home',
    name: 'Home',
    component: () => import('@/pages/home/index.vue'), // æ³¨æ„è¿™é‡Œè¦å¸¦ä¸Š æ–‡ä»¶åç¼€.vue
  },
  {
    path: '/dashboard',
    name: 'Dashboard',
    component: () => import('@/pages/dashboard/index.vue'),
  },
  {
    path: '/404',
    name: '404',
    hidden: true,
    meta: { notNeedAuth: true },
    component: () => import('@/pages/404/index.vue'),
  },
  // åŒ¹é…æ‰€æœ‰è·¯å¾„ vue2ä½¿ç”¨* vue3ä½¿ç”¨/:pathMatch(.*)æˆ–/:catchAll(.*)
  {
    path: '/:catchAll(.*)',
    redirect: '/404',
  },
];

// è·¯ç”±å®ä¾‹
const router = createRouter({
  history: createWebHashHistory(),
  routes,
});

export default router;
```

## è·¯ç”±ä½¿ç”¨

- ä¿®æ”¹å…¥å£æ–‡ä»¶ mian.ts

```tsx
import { createApp } from 'vue';
import App from '@/App.vue';
import router from './routes/index';
import '@/index.scss';

createApp(App).use(router).mount('#app');
```

- ä¿®æ”¹ App.vue æ–‡ä»¶

```vue
<script setup lang="ts">
import BasicLayout from '@/layouts/BasicLayout.vue';
import { useTitle } from '@/hooks';

// è®¾ç½® document title
useTitle();
</script>

<template>
  <BasicLayout />
</template>

<style lang="scss">
#app {
  height: 100vh;
  font-family: Avenir, Helvetica, Arial, sans-serif;
  color: #2c3e50;
  text-align: center;
}
</style>
```

## é¡µé¢ç¼–å†™

### Layout

- åœ¨ src æ–‡ä»¶å¤¹ä¸‹æ–°å¢ layouts æ–‡ä»¶å¤¹ => BasicLayout.vue æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹:

```vue
<script setup lang="ts">
// import { ref } from 'vue';
// const layout = ref('layout');
</script>

<template>
  <div class="layout">
    <header>LOGO</header>
    <p>
      <router-link to="/dashboard">dashboard</router-link>
      <router-link to="/home">home</router-link>
    </p>
    <img src="../assets/logo.png" />
    <router-view></router-view>
  </div>
</template>

<style scoped lang="scss">
.layout {
  height: 100%;
  header {
    @include style(calc(10px + 2vmin), #ffffff);
    @include flexContainer();

    min-height: 60px;
    background-color: $bg;
  }

  img {
    height: 20vmin;
    pointer-events: none;
  }

  button {
    font-size: calc(10px + 1vmin);
  }
}
</style>
```

### Dashboard

- åœ¨ src æ–‡ä»¶å¤¹ä¸‹æ–°å¢ pages æ–‡ä»¶å¤¹ => dashboard/index.vue æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹:

```vue
<script setup lang="ts">
import { ref, onMounted } from 'vue';

const dashboard = ref('Dashboard');

onMounted(() => {
  dashboard.value = 'Dashboard !!!';
  fetch('/api/datav-res/datav/map.json')
    .then((res) => res.json())
    .then((data) => console.log(data));
});
</script>

<template>
  <div>{{ dashboard }}</div>
</template>

<style scoped lang="scss"></style>
```

### Home

- åœ¨ src æ–‡ä»¶å¤¹ä¸‹æ–°å¢ pages æ–‡ä»¶å¤¹ => home/index.vue æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹:

```vue
<script setup lang="ts">
import { ref } from 'vue';

const home = ref('Home');
</script>

<template>
  <div>{{ home }}</div>
</template>

<style scoped lang="scss"></style>
```

### 404

- åœ¨ src æ–‡ä»¶å¤¹ä¸‹æ–°å¢ pages æ–‡ä»¶å¤¹ => 404/index.vue æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹:

```vue
<script setup lang="ts">
import { ref } from 'vue';

const msg = ref('NOT FUND');
</script>

<template>
  <div>{{ msg }}</div>
</template>

<style scoped lang="scss"></style>
```

# ä¸ƒã€çŠ¶æ€ç®¡ç†

## å®‰è£…ä¾èµ–

- [pinia è‹±æ–‡](https://pinia.vuejs.org/)
- [pinia ä¸­æ–‡](https://pinia.web3doc.top/)

```vue
pnpm install -S pinia
```

## çŠ¶æ€é…ç½®

- Pinia ä¸ Vuex çš„åŒºåˆ«ï¼š
  - id æ˜¯å¿…è¦çš„ï¼Œå®ƒå°†æ‰€ä½¿ç”¨ store è¿æ¥åˆ° devtoolsã€‚
  - åˆ›å»ºæ–¹å¼ï¼šnew Vuex.Store(...)(vuex3)ï¼ŒcreateStore(...)(vuex4)ã€‚
  - å¯¹æ¯”äº vuex3 ï¼Œstate ç°åœ¨æ˜¯ä¸€ä¸ªå‡½æ•°è¿”å›å¯¹è±¡ã€‚
  - æ²¡æœ‰ mutationsï¼Œä¸ç”¨æ‹…å¿ƒï¼Œstate çš„å˜åŒ–ä¾ç„¶è®°å½•åœ¨ devtools ä¸­ã€‚
- Pinia è®© Actions æ›´åŠ çš„çµæ´»ï¼š
  - å¯ä»¥é€šè¿‡ç»„ä»¶æˆ–å…¶ä»– action è°ƒç”¨
  - å¯ä»¥ä»å…¶ä»– store çš„ action ä¸­è°ƒç”¨
  - ç›´æ¥åœ¨ store å®ä¾‹ä¸Šè°ƒç”¨
  - æ”¯æŒåŒæ­¥æˆ–å¼‚æ­¥
  - æœ‰ä»»æ„æ•°é‡çš„å‚æ•°
  - å¯ä»¥åŒ…å«æœ‰å…³å¦‚ä½•æ›´æ”¹çŠ¶æ€çš„é€»è¾‘ï¼ˆä¹Ÿå°±æ˜¯ vuex çš„ mutations çš„ä½œç”¨ï¼‰
  - å¯ä»¥ $patch æ–¹æ³•ç›´æ¥æ›´æ”¹çŠ¶æ€å±æ€§
- åœ¨ src æ–‡ä»¶å¤¹ä¸‹æ–°å¢ stores æ–‡ä»¶å¤¹ => global.ts æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹:

```typescript
import { defineStore } from 'pinia';

export const useGlobalStore = defineStore({
  id: 'global',
  state: () => ({
    title: 'App',
    theme: 'default',
    language: 'zh',
  }),
  // getters
  getters: {
    // title: (state) => state.title,
  },
  actions: {
    setTitle(payload: string) {
      // å¯ä»¥åšå¼‚æ­¥
      // await doAjaxRequest(data);
      this.title = payload;
    },
    setTheme(payload: string) {
      this.theme = payload;
    },
    async setLanguage(payload: string) {
      // æ¨¡æ‹Ÿæ¥å£è¯·æ±‚
      await new Promise((resolve) => {
        setTimeout(() => {
          this.language = payload;
          resolve(payload);
        }, 1000);
      });
    },
  },
});
```

- åœ¨ src æ–‡ä»¶å¤¹ä¸‹æ–°å¢ stores æ–‡ä»¶å¤¹ => index.ts æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹:

```typescript
import { useGlobalStore } from './global';

export { useGlobalStore };
```

## çŠ¶æ€ä½¿ç”¨

- ä¿®æ”¹å…¥å£æ–‡ä»¶ mian.ts

```tsx
import { createApp } from 'vue';
import App from '@/App.vue';
import { createPinia } from 'pinia';
import router from './routes/index';
import '@/index.scss';

const app = createApp(App);
app.use(router);
app.use(createPinia());
app.mount('#app');
```

- ä¿®æ”¹ page/dashboard/index.vue æ–‡ä»¶

```vue
<script setup lang="ts">
import { ref, onMounted } from 'vue';
import { storeToRefs } from 'pinia';
import { useGlobalStore } from '@/stores';

const store = useGlobalStore();
const { title, language } = storeToRefs(store);
const dashboard = ref('Dashboard');

onMounted(() => {
  store.setLanguage('en');
  dashboard.value = 'Dashboard !!!';
  fetch('/api/datav-res/datav/map.json')
    .then((res) => res.json())
    .then((data) => console.log(data));
});
</script>

<template>
  <div>
    <p>{{ dashboard }}</p>
    <p>æ ‡é¢˜ï¼š{{ title }}</p>
    <p>è¯­è¨€ï¼š{{ language }}</p>
  </div>
</template>

<style scoped lang="scss"></style>
```

- ä¿®æ”¹ src/pags/home/index.vue æ–‡ä»¶

```vue
<script setup lang="ts">
import { ref } from 'vue';
import { storeToRefs } from 'pinia';
import { useGlobalStore } from '@/stores';

const home = ref('Home');
const store = useGlobalStore();
const { title, language } = storeToRefs(store);
</script>

<template>
  <div>
    <p>{{ home }}</p>
    <p>æ ‡é¢˜ï¼š{{ title }}</p>
    <p>è¯­è¨€ï¼š{{ language }}</p>
    <button @click="store.setTitle('Dep_App')">setTitle</button>
  </div>
</template>

<style scoped lang="scss"></style>
```

# å…«ã€è¯·æ±‚å°è£…

## å®‰è£…ä¾èµ–

```shell
pnpm i -S axios
pnpm i -S nprogress
pnpm i -S @types/nprogress
```

## Aixos å°è£…

- åœ¨ src æ–‡ä»¶å¤¹ä¸­ï¼Œæ–°å»º service æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”æ–°å»º src/service/request/index.tsã€src/service/request/types.tsã€src/service/index.ts æ–‡ä»¶

```typescript
import axios, { AxiosResponse } from 'axios';
import type { AxiosInstance, AxiosRequestConfig } from 'axios';
import type { RequestConfig, RequestInterceptors, CancelRequestSource } from './types';
import NProgress from 'nprogress';

class Request {
  // axios å®ä¾‹
  instance: AxiosInstance;
  // æ‹¦æˆªå™¨å¯¹è±¡
  interceptorsObj?: RequestInterceptors<AxiosResponse>;

  /*
  å­˜æ”¾å–æ¶ˆæ–¹æ³•çš„é›†åˆ
  * åœ¨åˆ›å»ºè¯·æ±‚åå°†å–æ¶ˆè¯·æ±‚æ–¹æ³• push åˆ°è¯¥é›†åˆä¸­
  * å°è£…ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥å–æ¶ˆè¯·æ±‚ï¼Œä¼ å…¥ url: string|string[]  
  * åœ¨è¯·æ±‚ä¹‹å‰åˆ¤æ–­åŒä¸€URLæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±å–æ¶ˆè¯·æ±‚
  */
  cancelRequestSourceList?: CancelRequestSource[];
  /*
  å­˜æ”¾æ‰€æœ‰è¯·æ±‚URLçš„é›†åˆ
  * è¯·æ±‚ä¹‹å‰éœ€è¦å°†url pushåˆ°è¯¥é›†åˆä¸­
  * è¯·æ±‚å®Œæ¯•åå°†urlä»é›†åˆä¸­åˆ é™¤
  * æ·»åŠ åœ¨å‘é€è¯·æ±‚ä¹‹å‰å®Œæˆï¼Œåˆ é™¤åœ¨å“åº”ä¹‹ååˆ é™¤
  */
  requestUrlList?: string[];

  constructor(config: RequestConfig) {
    this.requestUrlList = [];
    this.cancelRequestSourceList = [];
    this.instance = axios.create(config);
    this.interceptorsObj = config.interceptors;
    // æ‹¦æˆªå™¨æ‰§è¡Œé¡ºåº æ¥å£è¯·æ±‚ -> å®ä¾‹è¯·æ±‚ -> å…¨å±€è¯·æ±‚ -> å®ä¾‹å“åº” -> å…¨å±€å“åº” -> æ¥å£å“åº”
    this.instance.interceptors.request.use(
      (res: AxiosRequestConfig) => res,
      (err: any) => err,
    );

    // ä½¿ç”¨å®ä¾‹æ‹¦æˆªå™¨
    this.instance.interceptors.request.use(
      this.interceptorsObj?.requestInterceptors,
      this.interceptorsObj?.requestInterceptorsCatch,
    );
    this.instance.interceptors.response.use(
      this.interceptorsObj?.responseInterceptors,
      this.interceptorsObj?.responseInterceptorsCatch,
    );
    // å…¨å±€å“åº”æ‹¦æˆªå™¨ä¿è¯æœ€åæ‰§è¡Œ
    this.instance.interceptors.response.use(
      // å› ä¸ºæˆ‘ä»¬æ¥å£çš„æ•°æ®éƒ½åœ¨res.dataä¸‹ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥è¿”å›res.data
      (res: AxiosResponse) => {
        return res.data;
      },
      (err: any) => err,
    );
  }
  /**
   * @description: è·å–æŒ‡å®š url åœ¨ cancelRequestSourceList ä¸­çš„ç´¢å¼•
   * @param {string} url
   * @returns {number} ç´¢å¼•ä½ç½®
   */
  private getSourceIndex(url: string): number {
    return this.cancelRequestSourceList?.findIndex((item: CancelRequestSource) => {
      return Object.keys(item)[0] === url;
    }) as number;
  }
  /**
   * @description: åˆ é™¤ requestUrlList å’Œ cancelRequestSourceList
   * @param {string} url
   * @returns {*}
   */
  private delUrl(url: string) {
    const urlIndex = this.requestUrlList?.findIndex((u) => u === url);
    const sourceIndex = this.getSourceIndex(url);
    // åˆ é™¤urlå’Œcancelæ–¹æ³•
    urlIndex !== -1 && this.requestUrlList?.splice(urlIndex as number, 1);
    sourceIndex !== -1 && this.cancelRequestSourceList?.splice(sourceIndex as number, 1);
  }
  request<T>(config: RequestConfig<T>): Promise<T> {
    return new Promise((resolve, reject) => {
      NProgress.start();
      // å¦‚æœæˆ‘ä»¬ä¸ºå•ä¸ªè¯·æ±‚è®¾ç½®æ‹¦æˆªå™¨ï¼Œè¿™é‡Œä½¿ç”¨å•ä¸ªè¯·æ±‚çš„æ‹¦æˆªå™¨
      if (config.interceptors?.requestInterceptors) {
        config = config.interceptors.requestInterceptors(config);
      }
      const url = config.url;
      // urlå­˜åœ¨ä¿å­˜å–æ¶ˆè¯·æ±‚æ–¹æ³•å’Œå½“å‰è¯·æ±‚url
      if (url) {
        this.requestUrlList?.push(url);
        config.cancelToken = new axios.CancelToken((c) => {
          this.cancelRequestSourceList?.push({
            [url]: c,
          });
        });
      }
      this.instance
        .request<any, T>(config)
        .then((res) => {
          // å¦‚æœæˆ‘ä»¬ä¸ºå•ä¸ªå“åº”è®¾ç½®æ‹¦æˆªå™¨ï¼Œè¿™é‡Œä½¿ç”¨å•ä¸ªå“åº”çš„æ‹¦æˆªå™¨
          if (config.interceptors?.responseInterceptors) {
            res = config.interceptors.responseInterceptors(res);
          }
          // NProgress.done();
          resolve(res);
        })
        .catch((err: any) => {
          // NProgress.done();
          reject(err);
        })
        .finally(() => {
          NProgress.done();
          url && this.delUrl(url);
        });
    });
  }
  upload(url: string, data: File) {
    return new Promise((resolve, reject) => {
      NProgress.start();
      this.request({
        url,
        method: 'POST',
        data,
        headers: { 'Content-Type': 'multipart/form-data' },
      })
        .then((res: any) => {
          NProgress.done();
          resolve(res.data);
        })
        .catch((err) => {
          NProgress.done();
          reject(err.data);
        });
    });
  }
  download(url: string) {
    const iframe = document.createElement('iframe');
    iframe.style.display = 'none';
    iframe.src = url;
    iframe.onload = function () {
      document.body.removeChild(iframe);
    };
    document.body.appendChild(iframe);
  }
  // å–æ¶ˆè¯·æ±‚
  cancelRequest(url: string | string[]) {
    if (typeof url === 'string') {
      // å–æ¶ˆå•ä¸ªè¯·æ±‚
      const sourceIndex = this.getSourceIndex(url);
      sourceIndex >= 0 && this.cancelRequestSourceList?.[sourceIndex][url]();
    } else {
      // å­˜åœ¨å¤šä¸ªéœ€è¦å–æ¶ˆè¯·æ±‚çš„åœ°å€
      url.forEach((u) => {
        const sourceIndex = this.getSourceIndex(u);
        sourceIndex >= 0 && this.cancelRequestSourceList?.[sourceIndex][u]();
      });
    }
  }
  // å–æ¶ˆå…¨éƒ¨è¯·æ±‚
  cancelAllRequest() {
    this.cancelRequestSourceList?.forEach((source) => {
      const key = Object.keys(source)[0];
      source[key]();
    });
  }
}

export default Request;
export type { RequestConfig, RequestInterceptors };
```

```typescript
/* eslint-disable no-unused-vars */
import type { AxiosRequestConfig, AxiosResponse } from 'axios';
export interface RequestInterceptors<T> {
  // è¯·æ±‚æ‹¦æˆª
  requestInterceptors?: (config: AxiosRequestConfig) => AxiosRequestConfig;
  requestInterceptorsCatch?: (err: any) => any;
  // å“åº”æ‹¦æˆª
  responseInterceptors?: (config: T) => T;
  responseInterceptorsCatch?: (err: any) => any;
}
// è‡ªå®šä¹‰ä¼ å…¥çš„å‚æ•°
export interface RequestConfig<T = AxiosResponse> extends AxiosRequestConfig {
  interceptors?: RequestInterceptors<T>;
}
export interface CancelRequestSource {
  [index: string]: () => void;
}
```

```typescript
import Request from './request';
import { AxiosResponse } from 'axios';

import type { RequestConfig } from './request/types';

interface IResponse<T> {
  statusCode: number;
  desc: string;
  result: T;
}
interface IRequest<T> extends RequestConfig<IResponse<any>> {
  data?: T;
}

const request = new Request({
  baseURL: import.meta.env.VITE_API_HOST,
  timeout: 1000 * 60 * 5,
  interceptors: {
    // è¯·æ±‚æ‹¦æˆªå™¨
    requestInterceptors: (config) => config,
    // å“åº”æ‹¦æˆªå™¨
    responseInterceptors: (result: AxiosResponse) => {
      return result;
    },
  },
});

/**
 * @description: å‡½æ•°çš„æè¿°
 * @generic D è¯·æ±‚å‚æ•°
 * @generic T å“åº”ç»“æ„
 * @param {IRequest} config ä¸ç®¡æ˜¯GETè¿˜æ˜¯POSTè¯·æ±‚éƒ½ä½¿ç”¨data
 * @returns {Promise}
 */
const req = <D = any, T = any>(config: IRequest<D>) => {
  const { method = 'GET' } = config;
  if (method === 'get' || method === 'GET') {
    config.params = config.data;
  }
  return request.request<IResponse<T>>(config);
};
export const upload = (url: string, data: File) => {
  return request.upload(url, data);
};
export const download = (url: string) => {
  return request.download(url);
};
// å–æ¶ˆè¯·æ±‚
export const cancelRequest = (url: string | string[]) => {
  return request.cancelRequest(url);
};
// å–æ¶ˆå…¨éƒ¨è¯·æ±‚
export const cancelAllRequest = () => {
  return request.cancelAllRequest();
};

export default req;
```

## Axios ä½¿ç”¨

- åœ¨ src/apis æ–‡ä»¶å¤¹ä¸­ï¼Œæ–°å»º dashboard æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”æ–°å»º src/apis/dashboard/index.ts æ–‡ä»¶

```typescript
import request from '@/service';

export const getMapData = (data?: any) => {
  return request({
    url: '/datav-res/datav/map.json',
    method: 'GET',
    data,
    interceptors: {
      requestInterceptors(res: any) {
        console.log('æ¥å£è¯·æ±‚æ‹¦æˆª');
        return res;
      },
      responseInterceptors(result: any) {
        console.log('æ¥å£å“åº”æ‹¦æˆª');
        return result;
      },
    },
  });
};

export const getDashboardInfo = (data?: object) =>
  request({
    url: '/getDashboardInfo',
    method: 'POST',
    data,
  });
```

- åœ¨ src/apis æ–‡ä»¶å¤¹ä¸­ï¼Œæ–°å»º home æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”æ–°å»º src/apis/home/index.ts æ–‡ä»¶

```typescript
import request from '@/service';

export const getUserInfo = (data?: object) =>
  request({
    url: '/getUserInfo',
    method: 'POST',
    data,
  });
```

- ä¿®æ”¹å…¥å£æ–‡ä»¶ mian.ts

```tsx
import { createApp } from 'vue';
import App from '@/App.vue';
import { createPinia } from 'pinia';
import router from './routes/index';
import 'nprogress/nprogress.css';
import '@/index.scss';

const app = createApp(App);
app.use(router);
app.use(createPinia());
app.mount('#app');
```

- ä¿®æ”¹ç±»å‹å®šä¹‰æ–‡ä»¶ env.d.ts

```typescript
// / <reference types="vite/client" />

declare module '*.vue' {
  import { DefineComponent } from 'vue';
  // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/ban-types
  const component: DefineComponent<{}, {}, any>;
  export default component;
}

interface ImportMetaEnv {
  VITE_APP_TITLE: 'development' | 'test' | 'staging' | 'production';
  VITE_API_HOST: string;
}

interface ImportMeta {
  readonly env: ImportMetaEnv;
}
```

- ä¿®æ”¹ç¯å¢ƒå˜é‡æ–‡ä»¶ .env

```vue
VITE_APP_TITLE="DEVELOPMENT APP" VITE_API_HOST=/api
```

- ä¿®æ”¹ page/dashboard/index.vue æ–‡ä»¶

```vue
<script setup lang="ts">
import { ref, onMounted } from 'vue';
import { storeToRefs } from 'pinia';
import { useGlobalStore } from '@/stores';
import { getMapData } from '@/apis/dashboard';

const store = useGlobalStore();
const { title, language } = storeToRefs(store);
const dashboard = ref('Dashboard');

const getMap = async () => {
  const data = await getMapData();
  console.log(data);
};

onMounted(() => {
  store.setLanguage('en');
  dashboard.value = 'Dashboard !!!';
});
</script>

<template>
  <div>
    <p>{{ dashboard }}</p>
    <p>æ ‡é¢˜ï¼š{{ title }}</p>
    <p>è¯­è¨€ï¼š{{ language }}</p>
    <button @click="getMap">axios</button>
  </div>
</template>

<style scoped lang="scss"></style>
```

# ä¹ã€Mock

## å®‰è£…ä¾èµ–

```shell
pnpm install mockjs -S
pnpm install vite-plugin-mock -D
```

## æ’ä»¶é…ç½®

- åœ¨ config/plugins æ–‡ä»¶å¤¹ä¸­ï¼Œæ–°å»º mock.ts æ–‡ä»¶

```typescript
import { viteMockServe } from 'vite-plugin-mock';

export default function configMock(command: string) {
  return viteMockServe({
    // default
    mockPath: 'mock', // è§£ææ ¹ç›®å½•ä¸‹çš„mockæ–‡ä»¶å¤¹
    localEnabled: command === 'serve', // å¼€å‘æ‰“åŒ…å¼€å…³
    prodEnabled: false, // ç”Ÿäº§æ‰“åŒ…å¼€å…³
    supportTs: true, // æ‰“å¼€åï¼Œå¯ä»¥è¯»å– ts æ–‡ä»¶æ¨¡å—ã€‚ è¯·æ³¨æ„ï¼Œæ‰“å¼€åå°†æ— æ³•ç›‘è§†.js æ–‡ä»¶ã€‚
    watchFiles: true, // ç›‘è§†æ–‡ä»¶æ›´æ”¹
  });
}
```

- æ‰¾åˆ° config/plugins/index.ts æ–‡ä»¶ï¼Œæ–°å¢å¦‚ä¸‹ä»£ç 

```typescript
import configEslint from './eslint';
import configVisualizer from './visualizer';
import configHtml from './html';
import configCompression from './compression';
import configLegacy from './legacy';
import configMock from './mock';
import { VITE_APP_VISUALIZER } from '../index';

export default function createVitePlugins(command: string) {
  const vitePlugins: any[] = [configEslint(), configHtml(), configCompression(), configLegacy(), configMock(command)];
  VITE_APP_VISUALIZER && vitePlugins.push(configVisualizer());
  return vitePlugins;
}
```

- æ‰¾åˆ° vite.config.ts æ–‡ä»¶ï¼Œæ–°å¢å¦‚ä¸‹ä»£ç 

```typescript
import { defineConfig, ConfigEnv } from 'vite';
import vue from '@vitejs/plugin-vue';
import path from 'path';

import createVitePlugins from './config/plugins/index';
import createServer from './config/server';
import createBuild from './config/build';
import createCss from './config/style';
import { VITE_APP_BASE } from './config';

// https://vitejs.dev/config/
export default defineConfig(({ command, mode }: ConfigEnv) => ({
  plugins: [vue(), ...createVitePlugins(command)],
  base: VITE_APP_BASE,
  server: createServer(mode),
  build: createBuild(),
  css: createCss(),
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src'),
    },
  },
}));
```

## æ¥å£å®ç°

- åœ¨æ ¹ç›®å½•(å’Œ src åŒçº§)æ–°å»º mock æ–‡ä»¶å¤¹ï¼Œæ–°å»º mock/home.ts æ–‡ä»¶ã€mock/about.ts æ–‡ä»¶ä»¥åŠ mock/index.ts æ–‡ä»¶

```typescript
import { MockMethod } from 'vite-plugin-mock';
import Mock from 'mockjs';
export default [
  {
    url: '/api/getDashboardInfo',
    method: 'post',
    response: () => {
      return Mock.mock({
        code: 200,
        data: {
          nickname: '@cname',
          age: '@integer(10-100)',
          uid: '@id',
          url: '@image(200x100)',
          city: '@city',
          country: '@county(true)',
          province: '@province',
          mobile_phone: '@phone',
          email: '@email',
          region: '@region',
          menus: [
            {
              menu_name: 'ä¸€çº§å¯¼èˆª',
              id: '@id',
              code: 'Nav1',
              children: [
                {
                  code: 'about',
                  menu_url: 'views/about',
                  access_permissions: '["about"]',
                  children: [],
                  menu_name: 'æµ‹è¯•1',
                  id: '@id',
                },
                {
                  code: 'home',
                  menu_url: 'views/home',
                  access_permissions: '["home"]',
                  children: [],
                  menu_name: 'æµ‹è¯•2',
                  id: '@id',
                },
              ],
            },
          ],
        },
      });
    },
  },
] as MockMethod[];
```

```typescript
import { MockMethod } from 'vite-plugin-mock';
import Mock from 'mockjs';
export default [
  {
    url: '/api/getUserInfo',
    method: 'post',
    response: () => {
      return Mock.mock({
        code: 200,
        data: {
          nickname: 'about',
          age: '@integer(10-100)',
        },
      });
    },
  },
] as MockMethod[];
```

```typescript
export * from './dashboard';
export * from './home';
```

## Api å®ç°

- åœ¨ src/apis/dashboard/index.ts æ–‡ä»¶

```typescript
import request from '@/service';

export const getMapData = (data?: any) => {
  return request({
    url: '/datav-res/datav/map.json',
    method: 'GET',
    data,
    interceptors: {
      requestInterceptors(res: any) {
        console.log('æ¥å£è¯·æ±‚æ‹¦æˆª');
        return res;
      },
      responseInterceptors(result: any) {
        console.log('æ¥å£å“åº”æ‹¦æˆª');
        return result;
      },
    },
  });
};

export const getDashboardInfo = (data?: object) =>
  request({
    url: '/getDashboardInfo',
    method: 'POST',
    data,
  });
```

- åœ¨ src/apis/home/index.ts æ–‡ä»¶

```typescript
import request from '@/service';

export const getUserInfo = (data?: object) =>
  request({
    url: '/getUserInfo',
    method: 'POST',
    data,
  });
```

## Api è°ƒç”¨

- åœ¨ src/pages/dashboard/index.vue æ–‡ä»¶

```vue
<script setup lang="ts">
import { ref, onMounted } from 'vue';
import { storeToRefs } from 'pinia';
import { useGlobalStore } from '@/stores';
import { getMapData, getDashboardInfo } from '@/apis/dashboard';

const store = useGlobalStore();
const { title, language } = storeToRefs(store);
const dashboard = ref('Dashboard');

const getMap = async () => {
  const data = await getMapData();
  console.log(data);
};

onMounted(() => {
  store.setLanguage('en');
  dashboard.value = 'Dashboard !!!';
});
</script>

<template>
  <div>
    <p>{{ dashboard }}</p>
    <p>æ ‡é¢˜ï¼š{{ title }}</p>
    <p>è¯­è¨€ï¼š{{ language }}</p>
    <p><button @click="getMap">axios</button></p>
    <p><button @click="getDashboardInfo">mock</button></p>
  </div>
</template>

<style scoped lang="scss"></style>
```

- åœ¨ src/pages/home/index.vue æ–‡ä»¶

```vue
<script setup lang="ts">
import { ref } from 'vue';
import { storeToRefs } from 'pinia';
import { useGlobalStore } from '@/stores';
import { getUserInfo } from '@/apis/home';

const home = ref('Home');
const store = useGlobalStore();
const { title, language } = storeToRefs(store);
</script>

<template>
  <div>
    <p>{{ home }}</p>
    <p>æ ‡é¢˜ï¼š{{ title }}</p>
    <p>è¯­è¨€ï¼š{{ language }}</p>
    <button @click="store.setTitle('Dep_App')">setTitle</button>
    <p><button @click="getUserInfo">mock</button></p>
  </div>
</template>

<style scoped lang="scss"></style>
```

# åã€å›½é™…åŒ–

## å®‰è£…ä¾èµ–

- [i18next](https://www.i18next.com/)
- [vue-i18n](https://vue-i18n.intlify.dev/installation.html)

```shell
pnpm install -S vue-i18n
```

## åˆå§‹åŒ–é…ç½®

- åœ¨ src æ–‡ä»¶å¤¹ä¸­ï¼Œæ–°å»º locales æ–‡ä»¶å¤¹ï¼Œæ·»åŠ  index.ts æ–‡ä»¶ï¼Œå¯¹ i18n è¿›è¡Œåˆå§‹åŒ–æ“ä½œåŠæ’ä»¶é…ç½®

```typescript
import { createI18n } from 'vue-i18n';
import messages from './messages';

const i18nConfig = createI18n({
  fallbackLocale: 'zh',
  globalInjection: true,
  legacy: false, // you must set `false`, to use Composition API
  locale: 'zh',
  messages,
});

export default i18nConfig;
```

## å¤šè¯­è¨€é…ç½®

- åœ¨ src æ–‡ä»¶å¤¹ä¸­ï¼Œæ–°å»º locales/messages æ–‡ä»¶å¤¹ï¼Œæ·»åŠ  index.ts æ–‡ä»¶ï¼Œæ–°å¢ä»£ç å¦‚ä¸‹

```typescript
import en from './json/en.json';
import ja from './json/ja.json';
import zh from './json/zh.json';

const messages = {
  ja,
  en,
  zh,
};
export default messages;
```

- åœ¨ src/locales/messages æ–‡ä»¶å¤¹ä¸­ï¼Œæ–°å»º json æ–‡ä»¶å¤¹ï¼Œæ·»åŠ å¤šè¯­è¨€é…ç½®æ–‡ä»¶

```json
{
  "æ¬¢è¿ä½¿ç”¨ vue-i18n": "Welcome to react using vue-i18n",
  "åˆ‡æ¢è¯­è¨€": "change language",
  "åˆ‡æ¢åˆ°ä¸­æ–‡": "change to Chinese",
  "åˆ‡æ¢åˆ°è‹±æ–‡": "change to English",
  "åˆ‡æ¢åˆ°æ—¥æ–‡": "change to Japenese",
  "methods": {
    "renderProps": "change language with render props",
    "hook": "change language with hook",
    "hoc": "change language with hoc"
  }
}
```

```json
{
  "æ¬¢è¿ä½¿ç”¨ vue-i18n": "ã”åˆ©ç”¨ã‚’æ­“è¿ã™ã‚‹ vue-i18n",
  "åˆ‡æ¢è¯­è¨€": "è¨€èªã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹",
  "åˆ‡æ¢åˆ°ä¸­æ–‡": "ä¸­å›½èªã«åˆ‡ã‚Šæ›¿ãˆã‚‹",
  "åˆ‡æ¢åˆ°è‹±æ–‡": "è‹±æ–‡ã«åˆ‡ã‚Šæ›¿ãˆã‚‹",
  "åˆ‡æ¢åˆ°æ—¥æ–‡": "æ—¥æœ¬èªã«åˆ‡ã‚Šæ›¿ãˆã‚‹",
  "methods": {
    "renderProps": "renderPropsæ–¹å¼ã§è¨€èªã‚’å¤‰æ›ã™ã‚‹",
    "hook": "hookæ–¹å¼ã§è¨€èªã‚’å¤‰æ›ã™ã‚‹",
    "hoc": "hocæ–¹å¼ã§è¨€èªã‚’å¤‰æ›ã™ã‚‹"
  }
}
```

```json
{
  "æ¬¢è¿ä½¿ç”¨ vue-i18n": "æ¬¢è¿ä½¿ç”¨ vue-i18n",
  "åˆ‡æ¢è¯­è¨€": "åˆ‡æ¢è¯­è¨€",
  "åˆ‡æ¢åˆ°ä¸­æ–‡": "åˆ‡æ¢åˆ°ä¸­æ–‡",
  "åˆ‡æ¢åˆ°è‹±æ–‡": "åˆ‡æ¢åˆ°è‹±æ–‡",
  "åˆ‡æ¢åˆ°æ—¥æ–‡": "åˆ‡æ¢åˆ°æ—¥æ–‡",
  "methods": {
    "renderProps": "ç”¨renderPropsè½¬æ¢",
    "hook": "ç”¨hookè½¬æ¢",
    "hoc": "ç”¨hocè½¬æ¢"
  }
}
```

## å…¥å£æ–‡ä»¶é…ç½®

```tsx
import { createApp } from 'vue';
import App from '@/App.vue';
import { createPinia } from 'pinia';
import router from './routes/index';
import i18nConfig from './locales';
import 'nprogress/nprogress.css';
import '@/index.scss';

const app = createApp(App);
app.use(router);
app.use(createPinia());
app.use(i18nConfig);
app.mount('#app');
```

## åˆ‡æ¢è¯­è¨€

- dashboard

```vue
<script setup lang="ts">
import { ref, onMounted } from 'vue';
import { storeToRefs } from 'pinia';
import { useGlobalStore } from '@/stores';
import { getMapData, getDashboardInfo } from '@/apis/dashboard';
import { useI18n } from 'vue-i18n';

const { locale, t } = useI18n({ useScope: 'global' });

const change = (type: string) => {
  locale.value = type; // change!
};

const store = useGlobalStore();
const { title, language } = storeToRefs(store);
const dashboard = ref('Dashboard');

const getMap = async () => {
  const data = await getMapData();
  console.log(data);
};

onMounted(() => {
  store.setLanguage('en');
  dashboard.value = 'Dashboard !!!';
});
</script>

<template>
  <div>
    <p>{{ dashboard }}</p>
    <p>æ ‡é¢˜ï¼š{{ title }}</p>
    <p>è¯­è¨€ï¼š{{ language }}</p>
    <p>
      è¯­è¨€åˆ‡æ¢æµ‹è¯•ï¼š{{ t('æ¬¢è¿ä½¿ç”¨ vue-i18n') }}
      <button @click="change('zh')">{{ t('åˆ‡æ¢åˆ°ä¸­æ–‡') }}</button>
      <button @click="change('en')">{{ t('åˆ‡æ¢åˆ°è‹±æ–‡') }}</button>
      <button @click="change('ja')">{{ t('åˆ‡æ¢åˆ°æ—¥æ–‡') }}</button>
    </p>
    <p><button @click="getMap">axios</button></p>
    <p><button @click="getDashboardInfo">mock</button></p>
  </div>
</template>

<style scoped lang="scss"></style>
```

- home

```vue
<script setup lang="ts">
import { ref } from 'vue';
import { storeToRefs } from 'pinia';
import { useGlobalStore } from '@/stores';
import { getUserInfo } from '@/apis/home';
import { useI18n } from 'vue-i18n';

const { t } = useI18n({ useScope: 'global' });

const home = ref('Home');
const store = useGlobalStore();
const { title, language } = storeToRefs(store);
</script>

<template>
  <div>
    <p>{{ home }}</p>
    <p>æ ‡é¢˜ï¼š{{ title }}</p>
    <p>è¯­è¨€ï¼š{{ language }}</p>
    <p>è¯­è¨€åˆ‡æ¢æµ‹è¯•ï¼š{{ t('æ¬¢è¿ä½¿ç”¨ vue-i18n') }}</p>
    <button @click="store.setTitle('Dep_App')">setTitle</button>
    <p><button @click="getUserInfo">mock</button></p>
  </div>
</template>

<style scoped lang="scss"></style>
```

## è¸©å‘

> vue-i18n.esm-bundler.js:46
> You are running the esm-bundler build of vue-i18n. It is recommended to configure your bundler to explicitly replace feature flag globals with boolean literals to get proper tree-shaking in the final bundle.

```typescript
import { defineConfig, ConfigEnv } from 'vite';
import vue from '@vitejs/plugin-vue';
import path from 'path';

import createVitePlugins from './config/plugins/index';
import createServer from './config/server';
import createBuild from './config/build';
import createCss from './config/style';
import { VITE_APP_BASE } from './config';

// https://vitejs.dev/config/
export default defineConfig(({ command, mode }: ConfigEnv) => ({
  plugins: [vue(), ...createVitePlugins(command)],
  base: VITE_APP_BASE,
  server: createServer(mode),
  build: createBuild(),
  css: createCss(),
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src'),
      // è§£å†³è­¦å‘ŠYou are running the esm-bundler build of vue-i18n.
      'vue-i18n': 'vue-i18n/dist/vue-i18n.cjs.js',
    },
  },
}));
```

# åä¸€ã€Element-Plus

## å®‰è£…ä¾èµ–

```shell
pnpm install element-plus -S
pnpm install vite-plugin-style-import -D
```

## æ’ä»¶é…ç½®

- åœ¨ config/plugins æ–‡ä»¶å¤¹ä¸­ï¼Œæ–°å»º styleImport.ts æ–‡ä»¶

```typescript
import { createStyleImportPlugin, ElementPlusResolve } from 'vite-plugin-style-import';

export default function configStyleImport() {
  return createStyleImportPlugin({
    resolves: [ElementPlusResolve()],
    libs: [
      {
        libraryName: 'element-plus',
        esModule: true,
        base: 'element-plus/theme-chalk/base.css',
        resolveStyle: (name) => {
          return `element-plus/theme-chalk/${name}.css`;
        },
      },
    ],
  });
}
```

- æ‰¾åˆ° config/plugins/index.ts æ–‡ä»¶ï¼Œæ–°å¢å¦‚ä¸‹ä»£ç 

```typescript
import configEslint from './eslint';
import configVisualizer from './visualizer';
import configHtml from './html';
import configCompression from './compression';
import configLegacy from './legacy';
import configMock from './mock';
import configStyleImport from './styleImport';
import { VITE_APP_VISUALIZER } from '../index';

export default function createVitePlugins(command: string) {
  const vitePlugins: any[] = [
    configEslint(),
    configHtml(),
    configCompression(),
    configLegacy(),
    configMock(command),
    configStyleImport(),
  ];
  VITE_APP_VISUALIZER && vitePlugins.push(configVisualizer());
  return vitePlugins;
}
```

## Element-Plus ä½¿ç”¨

```vue
<script setup lang="ts">
import { ref } from 'vue';
import {
  ElContainer,
  ElHeader,
  ElAside,
  ElMain,
  ElMenu,
  ElMenuItem,
  ElSubMenu,
  ElIcon,
  ElScrollbar,
  ElSpace,
  ElAvatar,
  ElDropdown,
  ElDropdownMenu,
  ElDropdownItem,
} from 'element-plus';
import { DataLine, HelpFilled, ArrowDown } from '@element-plus/icons-vue';
import { useI18n } from 'vue-i18n';

const { locale, t } = useI18n({ useScope: 'global' });

const change = (type: string) => {
  locale.value = type; // change!
};
const scrollbarHeight = ref('calc(100vh - 60px)');
// const fill = ref(true);
</script>

<template>
  <el-container class="layout">
    <el-header>
      <el-space>
        <span class="logo">LOGO</span>
      </el-space>
      <el-space alignment="center" :size="30">
        <el-dropdown>
          <span>åˆ‡æ¢è¯­è¨€</span>
          <el-icon><arrow-down /></el-icon>
          <template #dropdown>
            <el-dropdown-menu>
              <el-dropdown-item @click="change('zh')">{{ t('åˆ‡æ¢åˆ°ä¸­æ–‡') }}</el-dropdown-item>
              <el-dropdown-item @click="change('en')">{{ t('åˆ‡æ¢åˆ°è‹±æ–‡') }}</el-dropdown-item>
              <el-dropdown-item @click="change('ja')">{{ t('åˆ‡æ¢åˆ°æ—¥æ–‡') }}</el-dropdown-item>
            </el-dropdown-menu>
          </template>
        </el-dropdown>
        <el-avatar src="https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png" />
      </el-space>
    </el-header>
    <el-container>
      <el-aside width="200px">
        <el-scrollbar :height="scrollbarHeight" view-style="height:100%">
          <el-menu
            :default-openeds="['2']"
            active-text-color="#ffd04b"
            background-color="#282c34"
            text-color="#fff"
            default-active="/dashboard"
            router
          >
            <el-menu-item index="/dashboard">
              <el-icon><DataLine /></el-icon>
              <span>å·¥ä½œå°</span>
            </el-menu-item>
            <el-sub-menu index="2">
              <template #title>
                <el-icon><HelpFilled /></el-icon>
                <span>é¦–é¡µ</span>
              </template>
              <el-menu-item index="/home">
                <span>å›¾è¡¨</span>
              </el-menu-item>
            </el-sub-menu>
          </el-menu>
        </el-scrollbar>
      </el-aside>
      <el-main>
        <el-scrollbar :height="scrollbarHeight">
          <router-view></router-view>
        </el-scrollbar>
      </el-main>
    </el-container>
  </el-container>
</template>

<style scoped lang="scss">
.layout {
  height: 100%;

  .logo {
    font-size: 24px;
  }

  .el-header {
    @include style(calc(10px + 2vmin), #ffffff);
    @include flexContainer(row, space-between);

    min-height: 60px;
    background-color: $bg;

    .el-space {
      .el-dropdown {
        color: #ffffff;
        cursor: pointer;

        .el-icon {
          margin-left: 5px;
        }
      }
    }
  }

  .el-aside {
    .el-scrollbar {
      .el-menu {
        height: 100%;

        .el-menu-item {
          a {
            display: inline-block;
            color: #ffffff;
            text-decoration: none;
          }
        }
      }
    }
  }

  .el-main {
    padding: 0;
  }
}
</style>
```

```vue
<script setup lang="ts">
import { ref, onMounted } from 'vue';
import { storeToRefs } from 'pinia';
import { useGlobalStore } from '@/stores';
import { getMapData, getDashboardInfo } from '@/apis/dashboard';
import { useI18n } from 'vue-i18n';
import { ElButton } from 'element-plus';

const { t } = useI18n({ useScope: 'global' });

const store = useGlobalStore();
const { title, language } = storeToRefs(store);
const dashboard = ref('Dashboard');

const getMap = async () => {
  const data = await getMapData();
  console.log(data);
};

onMounted(() => {
  store.setLanguage('en');
  dashboard.value = 'Dashboard !!!';
});
</script>

<template>
  <div>
    <p>{{ dashboard }}</p>
    <p>æ ‡é¢˜ï¼š{{ title }}</p>
    <p>è¯­è¨€ï¼š{{ language }}</p>
    <p>è¯­è¨€åˆ‡æ¢æµ‹è¯•ï¼š{{ t('æ¬¢è¿ä½¿ç”¨ vue-i18n') }}</p>
    <p><el-button type="warning" @click="getMap">axios</el-button></p>
    <p><el-button type="danger" @click="getDashboardInfo">mock</el-button></p>
  </div>
</template>

<style scoped lang="scss"></style>
```

```vue
<script setup lang="ts">
import { ref } from 'vue';
import { storeToRefs } from 'pinia';
import { useGlobalStore } from '@/stores';
import { getUserInfo } from '@/apis/home';
import { useI18n } from 'vue-i18n';
import { ElButton } from 'element-plus';

const { t } = useI18n({ useScope: 'global' });

const home = ref('Home');
const store = useGlobalStore();
const { title, language } = storeToRefs(store);
</script>

<template>
  <div>
    <p>{{ home }}</p>
    <p>æ ‡é¢˜ï¼š{{ title }}</p>
    <p>è¯­è¨€ï¼š{{ language }}</p>
    <p>è¯­è¨€åˆ‡æ¢æµ‹è¯•ï¼š{{ t('æ¬¢è¿ä½¿ç”¨ vue-i18n') }}</p>
    <el-button @click="store.setTitle('Dep_App')">setTitle</el-button>
    <p><el-button type="success" @click="getUserInfo">mock</el-button></p>
  </div>
</template>

<style scoped lang="scss"></style>
```

## Icon å›¾æ ‡ä½¿ç”¨

### å®‰è£…ä¾èµ–

```shell
pnpm install @element-plus/icons-vue -S
```

### Icon ä½¿ç”¨

```vue
<script setup lang="ts">
import { ref, onMounted } from 'vue';
import { storeToRefs } from 'pinia';
import { useGlobalStore } from '@/stores';
import { getMapData, getDashboardInfo } from '@/apis/dashboard';
import { useI18n } from 'vue-i18n';
import { ElButton, ElIcon } from 'element-plus';
import { AlarmClock } from '@element-plus/icons-vue';

const { t } = useI18n({ useScope: 'global' });

const store = useGlobalStore();
const { title, language } = storeToRefs(store);
const dashboard = ref('Dashboard');

const getMap = async () => {
  const data = await getMapData();
  console.log(data);
};

onMounted(() => {
  store.setLanguage('en');
  dashboard.value = 'Dashboard !!!';
});
</script>

<template>
  <div>
    <p>{{ dashboard }}</p>
    <p>æ ‡é¢˜ï¼š{{ title }}</p>
    <p>è¯­è¨€ï¼š{{ language }}</p>
    <el-icon :size="50" color="red">
      <AlarmClock />
    </el-icon>
    <p>è¯­è¨€åˆ‡æ¢æµ‹è¯•ï¼š{{ t('æ¬¢è¿ä½¿ç”¨ vue-i18n') }}</p>
    <p><el-button type="warning" @click="getMap">axios</el-button></p>
    <p><el-button type="danger" @click="getDashboardInfo">mock</el-button></p>
  </div>
</template>

<style scoped lang="scss"></style>
```

## å‚è€ƒ

# åäºŒã€æµ‹è¯•æ¡†æ¶

## å•å…ƒæµ‹è¯•

### å®‰è£…ä¾èµ–

```shell
pnpm install @types/jest jest -D
pnpm install @vue/vue3-jest -D
pnpm install babel-jest -D
pnpm install @vue/test-utils@next -D
pnpm install @testing-library/jest-dom -D
pnpm install ts-jest -D
pnpm install @babel/preset-env @babel/core -D
pnpm install identity-obj-proxy -D
```

![image.png](https://cdn.nlark.com/yuque/0/2022/png/738210/1650609944963-5d6c2ff0-b4a7-4d1c-8f67-ee3395d6aa31.png#clientId=u12bc0701-ddbf-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=633&id=uc4305ebf&margin=%5Bobject%20Object%5D&name=image.png&originHeight=882&originWidth=898&originalType=binary&ratio=1&rotation=0&showTitle=false&size=66533&status=done&style=none&taskId=u60550f87-78e0-4985-9f1d-1f64210c1ca&title=&width=644)

### jest é…ç½®

- æ–°å¢ jest.config.js æ–‡ä»¶ï¼ŒåŒ src åŒçº§ï¼Œä¸”ç¼–å†™å¦‚ä¸‹ä»£ç 

```javascript
module.exports = {
  preset: 'ts-jest',
  roots: ['<rootDir>'],
  moduleDirectories: ['node_modules', 'src'],
  extensionsToTreatAsEsm: ['.ts', '.tsx'],
  globals: {
    'ts-jest': {
      useESM: true,
    },
  },
  transform: {
    '^.+\\.vue$': '@vue/vue3-jest', // vue æ–‡ä»¶ç”¨ vue-jest è½¬æ¢
    '^.+\\.ts$': 'ts-jest', // ts æ–‡ä»¶ç”¨ ts-jest è½¬æ¢
  },
  testRegex: '(tests.unit.*.(test|spec)).(jsx?|tsx?)$',
  moduleFileExtensions: ['vue', 'ts', 'tsx', 'js', 'jsx', 'json', 'node'],
  collectCoverage: true,
  collectCoverageFrom: ['<rootDir>/src/**/*.{vue, ts,tsx,js,jsx}'],
  coverageDirectory: '<rootDir>/coverage/',
  verbose: true,
  testTimeout: 30000,
  // ä¸ºäº†ä¿®å¤ Consider using the "jsdom" test environment. é—®é¢˜
  testEnvironment: 'jsdom',
  coveragePathIgnorePatterns: ['<rootDir>/node_modules/', '(.*).d.ts$'],
  moduleNameMapper: {
    '^@/(.*)': '<rootDir>/src/$1',
    '^.+\\.module\\.(css|styl|less|sass|scss|png|jpg|ttf|woff|woff2|svg)$': 'identity-obj-proxy',
  },
};
```

### ESLint é…ç½®

- .eslintrc.js ä¸­ï¼Œæ–°å¢å¦‚ä¸‹ä»£ç 

```javascript
module.exports = {
  ....
  env: {
    ....
    jest: true,
  },
  ....
}
```

### è„šæœ¬é…ç½®

```json
"unit": "jest --colors --passWithNoTests",
"unit-watch": "jest --watchAll",
"coverage": "jest --coverage",
```

### jest ä½¿ç”¨

- åœ¨ src åŒçº§æ–°å»º tests ç›®å½•ï¼Œåœ¨ tests ç›®å½•ä¸­ç»§ç»­æ·»åŠ  unit ç›®å½•ï¼Œæ–°å»º HelloWorld.test.tsx æ–‡ä»¶ï¼Œå¹¶ç¼–å†™å¦‚ä¸‹ä»£ç 

```tsx
import getMsg from './utils';
import HelloWorld from '../../src/components/HelloWorld.vue';

test('1+1=2', () => {
  expect(1 + 1).toBe(2);
});
test('getMsg', () => {
  expect(getMsg()).toBe('this is msg');
});
test('HelloWorld', () => {
  console.log('HelloWorld', HelloWorld);
});
```

```typescript
export default function () {
  return 'this is msg';
}
```

### ç±»å‹å£°æ˜

- åœ¨ tests ç›®å½•ï¼Œåœ¨ tests ç›®å½•ä¸­ï¼Œæ–°å»º env.d.ts æ–‡ä»¶ï¼Œå¹¶ç¼–å†™å¦‚ä¸‹ä»£ç 

```typescript
// / <reference types="vite/client" />

declare module '*.vue' {
  import { DefineComponent } from 'vue';
  // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/ban-types
  const component: DefineComponent<{}, {}, any>;
  export default component;
}

declare const cy: any;
```

## E2E æµ‹è¯•

### å®‰è£…ä¾èµ–

```shell
pnpm install cypress @types/cypress -D
```

### cypress é…ç½®

- æ–°å¢ cypress.json æ–‡ä»¶ï¼ŒåŒ src åŒçº§ï¼Œä¸”ç¼–å†™å¦‚ä¸‹ä»£ç 

```javascript
{
  "pluginsFile": "tests/e2e/plugins/index.ts",
  "video":false
}
```

- åœ¨ src åŒçº§æ–°å»º tests ç›®å½•ï¼Œåœ¨ tests ç›®å½•ä¸­ç»§ç»­æ·»åŠ  e2e ç›®å½•ï¼Œæ–°å»º plugins/index.ts æ–‡ä»¶ï¼Œå¹¶ç¼–å†™å¦‚ä¸‹ä»£ç 

```typescript
module.exports = (on: any, config: any) => {
  // `on` is used to hook into various events Cypress emits
  // `config` is the resolved Cypress config
  return Object.assign({}, config, {
    // fixturesè·¯å¾„
    fixturesFolder: 'tests/e2e/fixtures',
    // æµ‹è¯•è„šæœ¬æ–‡ä»¶å¤¹
    integrationFolder: 'tests/e2e/specs',
    // ä» cy.screenshot() å‘½ä»¤æˆ–åœ¨ cypress è¿è¡ŒæœŸé—´æµ‹è¯•å¤±è´¥åä¿å­˜å±å¹•æˆªå›¾çš„æ–‡ä»¶å¤¹è·¯å¾„
    screenshotsFolder: 'tests/e2e/screenshots',
    // cypress è¿è¡ŒæœŸé—´ä¿å­˜è§†é¢‘çš„æ–‡ä»¶å¤¹è·¯å¾„
    videosFolder: 'tests/e2e/videos',
    // åœ¨åŠ è½½æµ‹è¯•æ–‡ä»¶ä¹‹å‰åŠ è½½çš„æ–‡ä»¶è·¯å¾„ã€‚ è¿™ä¸ªæ–‡ä»¶è¢«ç¼–è¯‘å’Œæ†ç»‘ã€‚ ï¼ˆé€šè¿‡ false ç¦ç”¨ï¼‰
    supportFile: 'tests/e2e/support/index.ts',
  });
};
```

- åœ¨ src åŒçº§æ–°å»º tests ç›®å½•ï¼Œåœ¨ tests ç›®å½•ä¸­ç»§ç»­æ·»åŠ  e2e ç›®å½•ï¼Œæ–°å»º support/index.ts æ–‡ä»¶ï¼Œå¹¶ç¼–å†™å¦‚ä¸‹ä»£ç 

```typescript
module.exports = {};
```

### è„šæœ¬é…ç½®

```json
"test": "pnpm unit && pnpm e2e",
"unit": "jest --colors --passWithNoTests",
"unit-watch": "jest --watchAll",
"coverage": "jest --coverage",
"e2e": "cypress open",
"e2e-run": "cypress run"
```

### cypress ä½¿ç”¨

- åœ¨ src åŒçº§æ–°å»º tests ç›®å½•ï¼Œåœ¨ tests ç›®å½•ä¸­ç»§ç»­æ·»åŠ  e2e ç›®å½•ï¼Œæ–°å»º specs/index.specs.tsx æ–‡ä»¶ï¼Œå¹¶ç¼–å†™å¦‚ä¸‹ä»£ç 

```tsx
describe('home', () => {
  it('button click', () => {
    cy.visit('http://localhost:3002');
    cy.get('main');
  });
});
```

## å‚è€ƒ

# åä¸‰ã€ç›®å½•ç»“æ„

```vue
â”œâ”€.vscode // vscodeé…ç½®æ–‡ä»¶ â”œâ”€config // viteé…ç½®æ–‡ä»¶ â”œâ”€coverage // jest coverage â”œâ”€dist // æ‰“åŒ…è¾“å‡ºæ–‡ä»¶ â”œâ”€doc // æ–‡æ¡£
â”œâ”€tests // æµ‹è¯•æ–‡ä»¶ â”œâ”€mock // mock apuå­˜æ”¾åœ°å€ï¼Œå’Œapiså¯¹åº” â”‚ â””â”€modules â”œâ”€src // ä»£ç æºæ–‡ä»¶ç›®å½• â”‚ â”œâ”€apis // apisç»Ÿä¸€ç®¡ç†
â”‚ â”‚ â””â”€modules // apiæ¨¡å— â”‚ â”œâ”€assets // é™æ€èµ„æº â”‚ â”‚ â””â”€images â”‚ â”œâ”€components // é¡¹ç›®ç»„ä»¶ç›®å½• â”‚ â”‚ â”œâ”€Icon â”‚ â”‚ â”œâ”€Charts â”‚ â”‚
â”œâ”€Message â”‚ â”œâ”€directives // æŒ‡ä»¤ç›®å½• â”‚ â”‚ â””â”€print â”‚ â”œâ”€hooks // hooksç›®å½• â”‚ â”œâ”€layouts // å¸ƒå±€ç»„ä»¶ â”‚ â”‚ â”œâ”€dashboard â”‚ â”‚ â”‚
â”œâ”€content â”‚ â”‚ â”‚ â”œâ”€header â”‚ â”‚ â”‚ â””â”€sider â”‚ â”‚ â””â”€fullpage â”‚ â”œâ”€locales // å›½é™…åŒ–é…ç½®æ–‡ä»¶ â”‚ â”œâ”€pages // é¡µé¢ç›®å½•åœ°å€ â”‚ â”œâ”€home â”‚
â””â”€about â”‚ â”œâ”€routes // è·¯ç”±ç›¸å…³ â”‚ â”‚ â””â”€routes â”‚ â”œâ”€service // axios å°è£… â”‚ â”‚ â””â”€request â”‚ â”œâ”€stores // çŠ¶æ€ç®¡ç†ç›¸å…³ â”‚
â”œâ”€styles // æ ·å¼ç›¸å…³ â”‚ â”œâ”€types // ç±»å‹å®šä¹‰ç›¸å…³ â”‚ â”œâ”€utils // å·¥å…·ç±»ç›¸å…³ â””â”€template // æ¨¡æ¿ç›¸å…³ â”œâ”€apis â””â”€page
```

# å‚è€ƒ
